"use strict";var Pathwaymap={pathwayid:null,init:function(){$q("#guides .form-wrapper").html("");Pathwaymap.api.get(function(a){Pathwaymap.view.render(a)})}};Pathwaymap.model={url:"api/pathwaymap",defaults:function(){return{title:"",description:""}},save:function(){var a=$q(".aero-modal form").aeroSerialize();Pathwaymap.api.create(a.guideid)}};Pathwaymap.view={render:function(a){var b=this;Aero.tpl.get("pathwaymaps.html",function(d){$q("#pathwaymaps").html("");var c=_q.template(d);$q("#pathwaymaps").append(c({pathwaymaps:a}));b.setEvents()})},renderForm:function(){var a=this;Aero.tpl.get("pathwaymap-form.html",function(b){Pathwaymap.api.getGuides(function(){var c=_q.template(b);Aero.confirm({title:"Add guide",msg:c({guides:Pathwaymap.GUIDES}),onConfirm:function(){Pathwaymap.model.save()}})})})},setEvents:function(){$q("body").off("keypress.sn").on("keypress.sn",function(b){var a=b.keyCode||b.which;if(b.target.tagName=="BODY"&&a=="78"&&b.shiftKey){Pathwaymap.view.renderForm()}});if(!$q("#pathwaymaps ul").hasClass()){$q("#pathwaymaps ul").sortable({distance:10,forcePlaceholderSize:true,placeholder:{element:function(){return $q("<li class='helper-card-droppable columns large-offset-4 large-4'><div></div></li>")},update:function(){return}},items:"li:not(.ui-state-disabled)",update:function(a,b){Pathwaymap.api.updateIndex()}})}$q("#guides .add").off("click.ag").on("click.ag",function(){Pathwaymap.view.renderForm();return false});$q("#guides .delete").off("click.pathd").on("click.pathd",function(){var a=$q(this).parents("li:eq(0)").data("id");Aero.confirm({title:"Unlink Guide",msg:"Are you sure you want to remove this guide from the pathway?",onConfirm:function(){Pathwaymap.api.del(a)}});return false})}};Pathwaymap.api={get:function(c,b){var a={};a.pathwayid=Pathwaymap.pathwayid;a.guideData=["title","step"];Aero.send(Pathwaymap.model.url+"/by_pathway",a,function(d){if(c){c(d)}},"GET")},getGuides:function(a){if(Pathwaymap.GUIDES){a(Pathwaymap.GUIDES);return}Aero.send("api/guides",{},function(b){Pathwaymap.GUIDES=b;a()},"GET")},create:function(a){Aero.log("Associating with guideid: "+a,"info");var b={pathwayid:Pathwaymap.pathwayid,guideid:a};Aero.send(Pathwaymap.model.url,b,function(c){if(c){Pathwaymap.init()}else{Utils.message("That guide is already in this pathway","warn")}},"POST")},updateIndex:function(){var a={};a.guides={};a.pathwayid=Pathwaymap.pathwayid;var b=$q("#pathwaymaps li");b.each(function(){if($q(this).data("id")){a.guides[$q(this).data("id")]=b.index($q(this))}});Aero.send(Pathwaymap.model.url+"/indexes",a,function(c){Pathwaymap.init()},"PUT")},del:function(a){Aero.log("Deleting with guideid: "+a,"info");var b={pathwayid:Pathwaymap.pathwayid,guideid:a};Aero.send(Pathwaymap.model.url,b,function(c){Pathwaymap.init()},"DELETE")}};$q(function(){Pathway.api.getByTitle(decodeURIComponent($q("#pathwaytitle").data("title")),function(a){$q(".description").html(a.description);Pathwaymap.pathwayid=a.id;Pathwaymap.init()})});