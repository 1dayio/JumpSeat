"use strict";var Roles={id:null,init:function(){Roles.api.get(function(a){Roles.view.render(a)})}};Roles.model={url:"api/role",defaults:function(){return{title:"",description:""}},validate:function(){var a=$q("form").isFormValid();return a},save:function(){var a=$q(".saving form").aeroSerialize();if(Roles.model.validate()){if(Roles.id){Roles.api.update(a,Roles.id)}else{Roles.api.create(a)}}}};Roles.view={render:function(d,f,c){var e=null;var a=this;if(d.length>0){Aero.tpl.get("roles.html",function(j){if(!c){$q("#roles ul").html("")}var g=_q.template(j);for(var h in d){$q("#roles ul").append(g({role:d[h]}))}if(f){f()}a.setEvents()})}else{var b=Roles.model.defaults();b.title="New Role";Roles.view.render([b],function(){Roles.view.renderForm(Roles.model.defaults(),$q(".front:last"))},true)}},renderForm:function(d,b){var a=this;var c=b.parents(".card").find(".back");Aero.tpl.get("role-form.html",function(f){Roles.id=(d)?d.id:null;if(!d){d={}}var e=_q.template(f);c.find(".columns").html(e({role:d}));Utils.card.flip(b);a.setEvents()})},updateCard:function(c){var a=$q(".saving");var b="role/"+encodeURIComponent(c.title);if(c.id){a.parents(".li:eq(0)").data("id",c.id)}a.find(".title").html(c.title);a.find(".description").html(c.description);a.find(".flip-button").attr("href",b)},newCard:function(){var a=Roles.model.defaults();a.title="New Role";Roles.view.render([a],function(){Roles.view.renderForm(Roles.model.defaults(),$q(".front:last"))},true)},setEvents:function(){var a=this;Utils.card.setEvents(AeroStep.lang.cardr);$q("input, textarea").off("keypress.k").on("keypress.k",function(c){var b=c.keyCode||c.which;if(b=="13"){$q(".saving").removeClass("saving");$q(this).parents(".card").addClass("saving");Roles.model.save();return false}});$q("body").off("keypress.sn").on("keypress.sn",function(c){var b=c.keyCode||c.which;if(c.target.tagName=="BODY"&&b=="78"&&c.shiftKey){a.newCard();return false}});$q(".add").off("click.patha").on("click.patha",function(){a.newCard();return false});$q(".delete").off("click.pathd").on("click.pathd",function(){var c=$q(this);var d=c.parents("li:eq(0)").data("id");var b=c.parents("form").find("input:eq(0)").val();Aero.confirm({ok:"delete",title:b,msg:"Are you sure you want to delete this role?",onConfirm:function(){c.parents(".card").addClass("deleting");Roles.api.del(d)}});return false});$q(".save").off("click.paths").on("click.paths",function(){$q(".saving").removeClass("saving");$q(this).parents(".card").addClass("saving");Roles.model.save();return false});$q(".edit").off("click.pathe").on("click.pathe",function(){var c=$q(this).parents("li:eq(0)").data("id");var b=$q(this);Roles.api.get(function(d){Roles.view.renderForm(d,b)},c);return false});$q(".cancel").off("click.pathc").on("click.pathc",function(){Utils.card.remove($q(this));return false})}};Roles.api={get:function(c,b){var a={};a.count=true;if(b){a.id=b}Aero.send(Roles.model.url,a,function(d){if(c){c(d)}},"GET")},getByTitle:function(b,c){var a={};a.title=b;Aero.send(Roles.model.url,a,function(d){if(c){c(d)}},"GET")},create:function(a,b){Aero.send(Roles.model.url,a,function(c){a.id=c;Roles.view.updateCard(a);Utils.card.flip($q(".saving form"),true,function(){$q(".saving form").remove();$q(".saving").removeClass("saving");if(b){b(c)}})},"POST")},update:function(a,c,b){a.id=c;Aero.send(Roles.model.url,a,function(d){Roles.view.updateCard(d);Utils.card.flip($q(".saving form"),true,function(){$q(".saving").removeClass("saving");if(b){b(d)}})},"PUT")},del:function(a){Aero.send(Roles.model.url,{id:a},function(b){Utils.card.remove($q(".deleting"))},"DELETE")}};