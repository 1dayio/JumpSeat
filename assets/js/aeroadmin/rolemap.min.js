"use strict";var Rolemap={roleid:null,initialized:false,init:function(){if(this.initialized){return}this.initialized=true;$q("#rolemap .form-wrapper").html("");Rolemap.view.render();var a={onDelete:function(b){if(b.length>0){Aero.confirm({ok:"un-link",title:"Removing Guide Links",msg:"Are you sure you want to remove the association for "+b.length+" items?",onConfirm:function(){Rolemap.api.del(b)}})}}};new Utils.menu("#menu",a)}};Rolemap.model={url:"api/rolemap",defaults:function(){return{title:"",description:""}},save:function(){var a=$q("form").aeroSerialize();Rolemap.api.create(a.guideid)}};Rolemap.view={table:null,render:function(){var a="rolemap/tableguide?roleid="+Rolemap.roleid;var b=[{width:"5%",sClass:"center"},{width:"30%"},{width:"50%"},{width:"5%",sClass:"center"},{width:"10%",sClass:"tright"}];this.table=new Utils.datatable(a,b);this.table.columns.adjust().draw();this.setEvents()},renderForm:function(){var a=this;Aero.tpl.get("rolemap-form.html",function(b){Rolemap.api.getPathways(function(){var c=_q.template(b);Aero.confirm({ok:"Save",title:"Associate to this role",msg:c({guides:Rolemap.GUIDES}),onConfirm:function(){Rolemap.model.save()}})})})},setEvents:function(){$q("ul.tabs a:eq(1)").off("click.tab1").on("click.tab1",function(a){Rolemap.init()});$q("ul.tabs a:eq(2)").off("click.tab2").on("click.tab2",function(a){RoleUserMap.init()});$q(".acl").change(function(){var d=$q(this).parents(".panel-active:eq(0)");var a=d.data("key");var b=d.data("type");var c={};c[a]={};c[a][b]=$q(this).is(":checked");Rolemap.api.putPermission(c)});$q("#rolemap .add").off("click.patha").on("click.patha",function(){Rolemap.view.renderForm();return false});$q("body").off("click.pathd").on("click.pathd","#rolemap .delete",function(){var b=$q(this).parents("div:eq(0)").data("id");var a=$q(this).parents("tr:eq(0)").find("td:eq(1)").text();Aero.confirm({ok:"un-link",title:a,msg:"Are you sure you want to un-link this guide?",onConfirm:function(){Rolemap.api.del(b)}});return false})}};Rolemap.api={get:function(c,b){var a={};a.roleid=Rolemap.roleid;Aero.send(Rolemap.model.url+"/by_role",a,function(d){if(c){c(d)}},"GET")},getPathways:function(a){if(Rolemap.GUIDES){a(Rolemap.GUIDES);return}Aero.send("api/guides",{},function(b){Rolemap.GUIDES=b;a()},"GET")},putPermission:function(a){a.id=Rolemap.roleid;Aero.send("api/role/permission",a,function(b){},"PUT")},create:function(a){Aero.log("Associating with guideid: "+a,"info");var b={roleid:Rolemap.roleid,guideid:a};Aero.send(Rolemap.model.url,b,function(c){if(c){Rolemap.view.table.ajax.reload()}},"POST")},del:function(a){Aero.log("Deleting with guideid: "+a,"info");var b={roleid:Rolemap.roleid,guideid:a};Aero.send(Rolemap.model.url,b,function(c){Rolemap.view.table.ajax.reload()},"DELETE")}};$q(function(){Rolemap.roleid=$q(".description").data("id");Rolemap.view.setEvents();Rolepath.init()});