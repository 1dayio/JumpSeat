"use strict";var Pagedata={id:null,init:function(){$q("#form-wrapper").html("");Pagedata.view.render();Pagedata.view.renderBasic();var a={onDelete:function(b){if(b.length>0){Aero.confirm({ok:"delete",title:"Deleting items",msg:"Your about to delete "+b.length+" items. Are you sure?",onConfirm:function(){Pagedata.api.del(b)}})}},onExport:function(b){Utils._export("pagedata",b)}};new Utils.menu("#menu",a)}};Pagedata.model={url:"api/pagedata",defaults:function(){return{title:"",description:""}},saveConfig:function(){var b=[];var a={};$q("#config .item").each(function(){var d=$q(this).find("input[type=hidden]");if(d.length){var c={id:d.val(),type:"js",prop:$q(this).find("textarea").attr("class"),value:$q(this).find("textarea").val()};b.push(c)}});a.data=b;Pagedata.api.updateBasic(a)},validate:function(){var a=$q("form").isFormValid();return a},save:function(){var a=$q("form").aeroSerialize();if(Pagedata.model.validate()){if(Pagedata.id){Pagedata.api.update(a,Pagedata.id)}else{Pagedata.api.create(a)}}}};Pagedata.view={table:null,render:function(){var a="pagedata/table";var b=[{width:"5%",sClass:"center"},{width:"30%"},{width:"50%"},{width:"5%",sClass:"center"},{width:"10%",sClass:"tright"}];this.table=new Utils.datatable(a,b);this.setEvents()},renderBasic:function(){Pagedata.api.getBasic(function(b){for(var a in b){if(b[a].prop=="username"){$q(".username").val(b[a].value);$q("#usernameid").val(b[a].id)}else{if(b[a].prop=="roles"){$q(".roles").val(b[a].value);$q("#roleid").val(b[a].id)}else{if(b[a].prop=="require"){$q(".require").val(b[a].value);$q("#requireid").val(b[a].id)}else{if(b[a].prop=="fire"){$q(".fire").val(b[a].value);$q("#fireid").val(b[a].id)}}}}}})},renderForm:function(a){Aero.tpl.get("pagedata-form.html",function(c){Pagedata.id=(a)?a.id:null;if(!a){a={}}var b=_q.template(c);Aero.confirm({ok:"save",title:"URL information",msg:b({pagedata:a}),onValidate:function(){return Pagedata.model.validate()},onConfirm:function(){Pagedata.model.save()}})})},setEvents:function(){$q("#form-wrapper").off("keypress.key").on("keypress.key",function(b){var a=b.keyCode||b.which;if(a=="13"){Pagedata.model.save()}});$q("body").off("keypress.sn").on("keypress.sn",function(b){var a=b.keyCode||b.which;if(b.target.tagName=="BODY"&&a=="78"&&b.shiftKey){Pagedata.view.renderForm()}});$q(".add").off("click.patha").on("click.patha",function(){Pagedata.view.renderForm();return false});$q("body").off("click.pathd").on("click.pathd",".delete",function(){var b=$q(this).parents("div:eq(0)").data("id");var a=$q(this).parents("tr:eq(0)").find("td:eq(1)").text();Aero.confirm({ok:"delete",title:a,msg:"Are you sure you want to delete this?",onConfirm:function(){Pagedata.api.del(b)}});return false});$q(".save").off("click.paths").on("click.paths",function(){Pagedata.model.save();return false});$q(".save-config").off("click.cpaths").on("click.cpaths",function(){Pagedata.model.saveConfig();return false});$q("body").off("click.pathe").on("click.pathe",".edit",function(){var a=$q(this).parents("div:eq(0)").data("id");Pagedata.api.get(function(b){Pagedata.view.renderForm(b)},a);return false});$q(".cancel").off("click.pathc").on("click.pathc",function(){$q("#form-wrapper").html("");return false})}};Pagedata.api={get:function(c,b){var a={};if(b){a={id:b}}Aero.send(Pagedata.model.url,a,function(d){if(c){c(d)}},"GET")},getBasic:function(a){Aero.send(Pagedata.model.url+"/basic",{},function(b){if(a){a(b)}},"GET")},create:function(a){Aero.send(Pagedata.model.url,a,function(){Pagedata.view.table.ajax.reload();$q("#form-wrapper").html("")},"POST")},update:function(a,c,b){a.id=c;Aero.send(Pagedata.model.url,a,function(d){Pagedata.view.table.ajax.reload();$q("#form-wrapper").html("");Utils.message(AeroStep.lang.success,"success",600);if(b){b(d)}},"PUT")},updateBasic:function(a,b){Aero.send(Pagedata.model.url,a,function(c){Pagedata.view.table.ajax.reload();$q("#form-wrapper").html("");Utils.message(AeroStep.lang.success,"success",600);if(b){b(c)}},"PUT")},del:function(a){Aero.send(Pagedata.model.url,{id:a},function(){Pagedata.view.table.ajax.reload();$q("#form-wrapper").html("")},"DELETE")}};$q(function(){Pagedata.init();setTimeout(function(){new Utils._import("#import",{uploader:"/api/import_pagedata",width:170,height:42},function(){Pagedata.view.table.ajax.reload()})},0)});