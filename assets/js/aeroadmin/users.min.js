"use strict";var User={id:null,init:function(){$q("#form-wrapper").html("");User.view.render();var a={onDelete:function(b){if(b.length>0){Aero.confirm({ok:"Delete",title:"Deleting",msg:"You are about to delete <strong>"+b.length+"</strong> user(s)</strong>?",onConfirm:function(){User.api.del(b)}})}},onExport:function(b){Utils._export("user",b)},onClone:function(b){User.api.clone(b)}};new Utils.menu("#menu",a)}};User.model={url:"api/users",defaults:function(){return{title:"",description:""}},validate:function(){var b=[];var e=$q("form").isFormValid();var a=$q('input[name="password"]');var d=$q(".passwordv");if(a.val()!=""&&$q(".password-verdict").text()=="Weak"){e=false;a.addClass("aero-require-error");b.push("Password is too weak")}if(a.val()!=d.val()){e=false;d.addClass("aero-require-error");b.push("Password and Confirm Password don't match")}if(!e){if($q(".aero-error-box").length==0){$q("form").prepend('<div class="aero-error-box"><ul></ul></div>')}for(var c in b){$q(".aero-error-box ul").append("<li>"+b[c]+"</li>")}if($q("#panel2-1 .aero-require-error").length==0){$q(".tabs li:eq(1) a").click()}}return e},save:function(){var a=$q("form").aeroSerialize();a.sysadmin=(a.sysadmin)?true:false;if(User.id){User.api.update(a,User.id)}else{User.api.create(a)}}};User.view={table:null,render:function(){var a="users/table";var b=[{width:"3%",sClass:"center"},{width:"10%"},{width:"10%"},{width:"15%"},{width:"5%"},{width:"13%"},{width:"5%",sClass:"center"},{width:"5%",sClass:"tright"}];this.table=new Utils.datatable(a,b);this.setEvents()},renderForm:function(a){Aero.tpl.get("user-form.html",function(d){User.id=(a)?a.id:null;if(!a){a={}}var c=_q.template(d);Aero.confirm({ok:"save",title:"User Information",msg:c({user:a}),onValidate:function(){return User.model.validate()},onConfirm:function(){User.model.save()}});$q(document).foundation();var b={onKeyUp:function(e){$q(e.target).pwstrength("outputErrorList")}};$q('input[name="password"]').pwstrength(b)})},setEvents:function(){$q("body").off("keypress.sn").on("keypress.sn",function(b){var a=b.keyCode||b.which;if(b.target.tagName=="BODY"&&a=="78"&&b.shiftKey){User.view.renderForm()}});$q(".add").off("click.patha").on("click.patha",function(){User.view.renderForm();return false});$q("body").off("click.pathd").on("click.pathd",".delete",function(){var b=$q(this).parents("div:eq(0)").data("id");var a=$q(this).parents("tr").find("td:eq(1)").text();Aero.confirm({ok:"Delete",title:a,msg:"Are you sure you want to delete this?",onConfirm:function(){User.api.del(b)}});return false});$q("body").off("click.pathe").on("click.pathe",".edit",function(){var a=$q(this).parents("div:eq(0)").data("id");User.api.get(function(b){User.view.renderForm(b)},a);return false});$q("body").on("change","#emailuser",function(){var a=this;$q("input[type=password]").each(function(){if($q(a).is(":checked")){$q(this).prop("disabled",true)}else{$q(this).prop("disabled",false)}})})}};User.api={get:function(c,b){var a={};if(b){a={id:b}}Aero.send(User.model.url,a,function(d){if(c){c(d)}},"GET")},create:function(a){Aero.send(User.model.url,a,function(){User.view.table.ajax.reload()},"POST")},clone:function(a){Aero.send(User.model.url+"/clone",{id:a},function(){User.view.table.ajax.reload()},"POST")},update:function(a,c,b){a.id=c;Aero.send(User.model.url,a,function(d){User.view.table.ajax.reload();if(b){b(d)}},"PUT")},del:function(a){Aero.send(User.model.url,{id:a},function(){User.view.table.ajax.reload()},"DELETE")}};$q(function(){User.init();setTimeout(function(){new Utils._import("#import",{uploader:"/api/import_user",width:177},function(){User.view.table.ajax.reload()})},0)});