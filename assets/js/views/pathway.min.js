"use strict";require(["api/pathways"],function(){Pathway.view={init:function(){Pathway.api.get(function(a){Pathway.view.render(a)})},render:function(b,f,d){var e=null;var a=this;if(b.length>0){Aero.tpl.get("pathways.html",function(j){if(!d){$q("#pathways ul").html("")}var g=_q.template(j);for(var h in b){$q("#pathways ul").append(g({pathway:b[h]}))}if(f){f()}a.setEvents()})}else{var c=Pathway.model.defaults();c.title="New Pathway";Pathway.view.render([c],function(){Pathway.view.renderForm(Pathway.model.defaults(),$q(".front:last"))},true)}},renderForm:function(b,c){var a=this;var d=c.parents(".card").find(".back");Aero.tpl.get("pathway-form.html",function(f){Pathway.id=(b)?b.id:null;if(!b){b={}}var e=_q.template(f);d.find(".columns").html(e({pathway:b}));Utils.card.flip(c);a.setEvents()})},updateCard:function(c){var a=$q(".saving");var b="pathway/"+encodeURIComponent(c.title);if(c.id){a.parents(".li:eq(0)").data("id",c.id)}a.find(".title").html(c.title);a.find(".description").html(c.description);a.find(".flip-button").attr("href",b)},newCard:function(){var a=Pathway.model.defaults();a.title="New Pathway";Pathway.view.render([a],function(){Pathway.view.renderForm(Pathway.model.defaults(),$q(".front:last"))},true)},setEvents:function(){var a=this;Utils.card.setEvents(AeroStep.lang.cardr);$q("input, textarea").off("keypress.k").on("keypress.k",function(c){var b=c.keyCode||c.which;if(b=="13"){$q(".saving").removeClass("saving");$q(this).parents(".card").addClass("saving");Pathway.model.save();return false}});$q("body").off("keypress.sn").on("keypress.sn",function(c){var b=c.keyCode||c.which;if(c.target.tagName=="BODY"&&b=="78"&&c.shiftKey){a.newCard();return false}});$q(".add").off("click.patha").on("click.patha",function(){a.newCard();return false});$q(".delete").off("click.pathd").on("click.pathd",function(){var c=$q(this);var d=c.parents("li:eq(0)").data("id");var b=c.parents("form").find("input:eq(0)").val();Aero.confirm({ok:"delete",title:b,msg:"Are you sure you want to delete this item?",onConfirm:function(){c.parents(".card").addClass("deleting");Pathway.api.del(d)}});return false});$q(".save").off("click.paths").on("click.paths",function(){$q(".saving").removeClass("saving");$q(this).parents(".card").addClass("saving");Pathway.model.save();return false});$q(".edit").off("click.pathe").on("click.pathe",function(){var c=$q(this).parents("li:eq(0)").data("id");var b=$q(this);Pathway.api.get(function(d){Pathway.view.renderForm(d,b)},c);return false});$q(".cancel").off("click.pathc").on("click.pathc",function(){Utils.card.remove($q(this));return false})}};$q(function(){Pathway.view.init()})});