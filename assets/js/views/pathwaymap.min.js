"use strict";require(["api/pathways"],function(){var a={pathwayid:null,init:function(){$q("#guides .form-wrapper").html("");a.api.get(function(b){a.view.render(b)})}};a.model={url:"api/pathwaymap",defaults:function(){return{title:"",description:""}},save:function(){var b=$q(".aero-modal form").aeroSerialize();a.api.create(b.guideid)}};a.view={render:function(b){var c=this;Aero.tpl.get("pathwaymaps.html",function(e){$q("#pathwaymaps").html("");var d=_q.template(e);$q("#pathwaymaps").append(d({pathwaymaps:b}));c.setEvents()})},renderForm:function(){var b=this;Aero.tpl.get("pathwaymap-form.html",function(c){a.api.getGuides(function(){var d=_q.template(c);Aero.confirm({title:"Add guide",msg:d({guides:a.GUIDES}),onConfirm:function(){a.model.save()}})})})},setEvents:function(){$q("body").off("keypress.sn").on("keypress.sn",function(c){var b=c.keyCode||c.which;if(c.target.tagName=="BODY"&&b=="78"&&c.shiftKey){a.view.renderForm()}});if(!$q("#pathwaymaps ul").hasClass()){$q("#pathwaymaps ul").sortable({distance:10,forcePlaceholderSize:true,placeholder:{element:function(){return $q("<li class='helper-card-droppable columns large-offset-4 large-4'><div></div></li>")},update:function(){return}},items:"li:not(.ui-state-disabled)",update:function(b,c){a.api.updateIndex()}})}$q("#guides .add").off("click.ag").on("click.ag",function(){a.view.renderForm();return false});$q("#guides .delete").off("click.pathd").on("click.pathd",function(){var b=$q(this).parents("li:eq(0)").data("id");Aero.confirm({title:"Unlink Guide",msg:"Are you sure you want to remove this guide from the pathway?",onConfirm:function(){a.api.del(b)}});return false})}};a.api={get:function(d,c){var b={};b.pathwayid=a.pathwayid;b.guideData=["title","step"];Aero.send(a.model.url+"/by_pathway",b,function(e){if(d){d(e)}},"GET")},getGuides:function(b){if(a.GUIDES){b(a.GUIDES);return}Aero.send("api/guides",{},function(c){a.GUIDES=c;b()},"GET")},create:function(b){Aero.log("Associating with guideid: "+b,"info");var c={pathwayid:a.pathwayid,guideid:b};Aero.send(a.model.url,c,function(d){if(d){a.init()}else{Utils.message("That guide is already in this pathway","warn")}},"POST")},updateIndex:function(){var b={};b.guides={};b.pathwayid=a.pathwayid;var c=$q("#pathwaymaps li");c.each(function(){if($q(this).data("id")){b.guides[$q(this).data("id")]=c.index($q(this))}});Aero.send(a.model.url+"/indexes",b,function(d){a.init()},"PUT")},del:function(b){Aero.log("Deleting with guideid: "+b,"info");var c={pathwayid:a.pathwayid,guideid:b};Aero.send(a.model.url,c,function(d){a.init()},"DELETE")}};$q(function(){Pathway.api.getByTitle(decodeURIComponent($q("#pathwaytitle").data("title")),function(b){$q(".description").html(b.description);a.pathwayid=b.id;a.init()})})});