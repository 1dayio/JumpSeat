"use strict";require(["api/roles"],function(){Roles.view={init:function(){Roles.api.get(function(a){Roles.view.render(a)})},render:function(d,f,c){var e=null;var a=this;if(d.length>0){Aero.tpl.get("roles.html",function(j){if(!c){$q("#roles ul").html("")}var g=_q.template(j);for(var h in d){$q("#roles ul").append(g({role:d[h]}))}if(f){f()}a.setEvents()})}else{var b=Roles.model.defaults();b.title="New Role";Roles.view.render([b],function(){Roles.view.renderForm(Roles.model.defaults(),$q(".front:last"))},true)}},renderForm:function(d,b){var a=this;var c=b.parents(".card").find(".back");Aero.tpl.get("role-form.html",function(f){Roles.id=(d)?d.id:null;if(!d){d={}}var e=_q.template(f);c.find(".columns").html(e({role:d}));Utils.card.flip(b);a.setEvents()})},updateCard:function(c){var a=$q(".saving");var b="role/"+encodeURIComponent(c.title);if(c.id){a.parents(".li:eq(0)").data("id",c.id)}a.find(".title").html(c.title);a.find(".description").html(c.description);a.find(".flip-button").attr("href",b)},newCard:function(){var a=Roles.model.defaults();a.title="New Role";Roles.view.render([a],function(){Roles.view.renderForm(Roles.model.defaults(),$q(".front:last"))},true)},setEvents:function(){var a=this;Utils.card.setEvents(AeroStep.lang.cardr);$q("input, textarea").off("keypress.k").on("keypress.k",function(c){var b=c.keyCode||c.which;if(b=="13"){$q(".saving").removeClass("saving");$q(this).parents(".card").addClass("saving");Roles.model.save();return false}});$q("body").off("keypress.sn").on("keypress.sn",function(c){var b=c.keyCode||c.which;if(c.target.tagName=="BODY"&&b=="78"&&c.shiftKey){a.newCard();return false}});$q(".add").off("click.patha").on("click.patha",function(){a.newCard();return false});$q(".delete").off("click.pathd").on("click.pathd",function(){var c=$q(this);var d=c.parents("li:eq(0)").data("id");var b=c.parents("form").find("input:eq(0)").val();Aero.confirm({ok:"delete",title:b,msg:"Are you sure you want to delete this role?",onConfirm:function(){c.parents(".card").addClass("deleting");Roles.api.del(d)}});return false});$q(".save").off("click.paths").on("click.paths",function(){$q(".saving").removeClass("saving");$q(this).parents(".card").addClass("saving");Roles.model.save();return false});$q(".edit").off("click.pathe").on("click.pathe",function(){var c=$q(this).parents("li:eq(0)").data("id");var b=$q(this);Roles.api.get(function(d){Roles.view.renderForm(d,b)},c);return false});$q(".cancel").off("click.pathc").on("click.pathc",function(){Utils.card.remove($q(this));return false})}};$q(function(){Roles.view.init()})});