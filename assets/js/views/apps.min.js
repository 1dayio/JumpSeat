"use strict";require(["api/apps"],function(){App.view={init:function(){$q("#form-wrapper").html("");var a={};new Utils.menu("#userMenu",a);App.api.get(function(b){App.view.render(b)})},render:function(d,f,c){var e=null;var a=this;$q(".app-loading").remove();if(d.length>0){Aero.tpl.get("apps.html",function(l){if(!c){$q("#apps ul").html("")}var h=_q.template(l);for(var j in d){var k=(d[j].host)?d[j].host:"http://example.com";d[j].hostLink=k.replace(/:\/\/|\./g,"_");d[j].host=k;var g=d[j].title.replace(/(\w)\w*\W*/g,function(m,n){return n});d[j].syn=g.slice(0,2);e=$q("#apps ul").append(h({app:d[j]}))}if(f){f()}a.setEvents()})}else{var b=App.model.defaults();b.title="New Application";b.host="http://example.com";App.view.render([b],function(){App.view.renderForm(App.model.defaults(),$q(".front:last"))},true)}},renderForm:function(d,b){var a=this;var c=b.parents(".card").find(".back");Aero.tpl.get("app-form.html",function(f){App.id=(d)?d.id:null;if(!d){d={}}var e=_q.template(f);c.find(".columns").html(e({app:d}));Utils.card.flip(b);a.setEvents()})},updateCard:function(e){var b=$q(".saving");var d=(e.host)?e.host:"http://example.com";d=d.replace(/:\/\/|\./g,"_");var c="/app/"+d+"/";if(e.id){b.parents(".app:eq(0)").data("id",e.id)}b.find(".host a").html(e.host);b.find(".host a").attr("href",e.host);b.find(".title").html(e.title);b.find(".description").html(e.description);b.find(".link-guide").attr("href",c+"guides");b.find(".link-path").attr("href",c+"pathways");var a=e.title.replace(/(\w)\w*\W*/g,function(f,g){return g});b.find(".avatar span").html(a.slice(0,2))},newCard:function(){var a=App.model.defaults();a.title="New Application";App.view.render([a],function(){App.view.renderForm(App.model.defaults(),$q(".front:last"))},true);return false},renderIssue:function(){Aero.confirm({ok:"Ok",title:"Domain Exists",msg:"You tried to save an application with a domain that already exists. Please select another domain.",onConfirm:function(){return false}})},setEvents:function(){var a=this;$q("input, textarea").off("keypress.k").on("keypress.k",function(c){var b=c.keyCode||c.which;if(b=="13"){$q(".saving").removeClass("saving");$q(this).parents(".card").addClass("saving");App.model.save($q(this));return false}});$q("body").off("keypress.sn").on("keypress.sn",function(c){var b=c.keyCode||c.which;if(c.target.tagName=="BODY"&&b=="78"&&c.shiftKey){a.newCard();return false}});$q(".add").off("click.patha").on("click.patha",function(){a.newCard();return false});$q(".delete").off("click.pathd").on("click.pathd",function(){var c=$q(this);var d=c.parents("li:eq(0)").data("id");var b=$q(this).parents("form").find("input:eq(1)").val();Aero.confirm({ok:"Delete",title:b,msg:"Are you sure you want to delete this app?",onConfirm:function(){c.parents(".card").addClass("deleting");App.api.del(d)}});return false});$q(".save").off("click.paths").on("click.paths",function(){$q(".saving").removeClass("saving");$q(this).parents(".card").addClass("saving");if($q(".alias-wrapper").is(":visible")){$q(".add-alias").click()}App.model.save($q(this));return false});$q(".edit").off("click.pathe").on("click.pathe",function(){var c=$q(this).parents("li:eq(0)").data("id");var b=$q(this);App.api.get(function(d){App.view.renderForm(d,b)},c);return false});$q(".add-alias").off("click.alias").on("click.alias",function(){var c=$q(this).parents(".back");var b=c.find(".alias").is(":visible");if(!b){c.find(".alias-wrapper").show();c.find(".add-alias i").html("&#xF500;");Utils.card.setHeight(this)}else{c.find(".alias-wrapper").hide();c.find(".add-alias i").html("&#xF501;");Utils.card.setHeight(this)}});$q(".add-alias-btn").off("click.aliasb").on("click.aliasb",function(){var d=$q(this).parents(".back");var c=d.find(".alias-wrapper").is(":visible");var b=$q('<div class="row collapse alias" style="display:block;">					<div class="large-12 columns">						<input class="alias-input" type="text" placeholder="http://uat.example.com">						<a class="delete-alias"><i class="ss-delete"></i></a>					</div>				</div>');d.find(".alias-wrapper").append(b);if(!c){d.find("a.add-alias").click()}Utils.card.setHeight(this)});$q("body").off("click.aliasd").on("click.alaisd",".delete-alias",function(){var b=$q(this).parents(".alias-wrapper");$q(this).parents(".alias:eq(0)").remove();Utils.card.setHeight(b);return false});$q(".cancel").off("click.pathc").on("click.pathc",function(){Utils.card.remove($q(this));return false});$q("body").off("change.active").on("change.active","input[type='checkbox']",function(){var b={};b.active=$q(this).is(":checked");var c=$q(this).parents(".app").data("id");App.api.update(b,c)})}};$q(function(){App.view.init()})});