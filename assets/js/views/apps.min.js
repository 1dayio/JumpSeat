"use strict";require(["aero"],function(){var a={id:null,init:function(){$q("#form-wrapper").html("");a.api.get(function(b){a.view.render(b)})}};a.model={url:"api/apps",defaults:function(){return{title:"",description:"",active:true}},validate:function(){var d=$q(".saving form").isFormValid();var c=$q('.saving input[name="host"]');var b=/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(c.val());if(c.val()!=IAPP&&!b){d=false;c.addClass("aero-require-error")}return d},save:function(c){var b=c.parents(".card").find("form");var d=b.aeroSerialize();d.active=(d.active)?true:false;d.aliases=[];d.host=d.host.replace(/\/$/,"");$q(".alias-input").each(function(){var e=$q(this).val();if(e){e=e.replace(/\/$/,"");d.aliases.push(e)}});if(a.model.validate()){if(a.id){a.api.update(d,a.id)}else{a.api.create(d)}}}};a.view={render:function(e,g,d){var f=null;var b=this;if(e.length>0){Aero.tpl.get("apps.html",function(m){if(!d){$q("#apps ul").html("")}var j=_q.template(m);for(var k in e){var l=(e[k].host)?e[k].host:"http://example.com";e[k].hostLink=l.replace(/:\/\/|\./g,"_");e[k].host=l;var h=e[k].title.replace(/(\w)\w*\W*/g,function(n,o){return o});e[k].syn=h.slice(0,2);f=$q("#apps ul").append(j({app:e[k]}))}if(g){g()}b.setEvents()})}else{var c=a.model.defaults();c.title="New Application";c.host="http://example.com";a.view.render([c],function(){a.view.renderForm(a.model.defaults(),$q(".front:last"))},true)}},renderForm:function(e,c){var b=this;var d=c.parents(".card").find(".back");Aero.tpl.get("app-form.html",function(g){a.id=(e)?e.id:null;if(!e){e={}}var f=_q.template(g);d.find(".columns").html(f({app:e}));Utils.card.flip(c);b.setEvents()})},updateCard:function(f){var c=$q(".saving");var e=(f.host)?f.host:"http://example.com";e=e.replace(/:\/\/|\./g,"_");var d="/app/"+e+"/";if(f.id){c.parents(".app:eq(0)").data("id",f.id)}c.find(".host a").html(f.host);c.find(".host a").attr("href",f.host);c.find(".title").html(f.title);c.find(".description").html(f.description);c.find(".link-guide").attr("href",d+"guides");c.find(".link-path").attr("href",d+"pathways");var b=f.title.replace(/(\w)\w*\W*/g,function(g,h){return h});c.find(".avatar span").html(b.slice(0,2))},newCard:function(){var b=a.model.defaults();b.title="New Application";a.view.render([b],function(){a.view.renderForm(a.model.defaults(),$q(".front:last"))},true);return false},renderIssue:function(){Aero.confirm({ok:"Ok",title:"Domain Exists",msg:"You tried to save an application with a domain that already exists. Please select another domain.",onConfirm:function(){return false}})},setEvents:function(){var b=this;$q("input, textarea").off("keypress.k").on("keypress.k",function(d){var c=d.keyCode||d.which;if(c=="13"){$q(".saving").removeClass("saving");$q(this).parents(".card").addClass("saving");a.model.save($q(this));return false}});$q("body").off("keypress.sn").on("keypress.sn",function(d){var c=d.keyCode||d.which;if(d.target.tagName=="BODY"&&c=="78"&&d.shiftKey){b.newCard();return false}});$q(".add").off("click.patha").on("click.patha",function(){b.newCard();return false});$q(".delete").off("click.pathd").on("click.pathd",function(){var d=$q(this);var e=d.parents("li:eq(0)").data("id");var c=$q(this).parents("form").find("input:eq(1)").val();Aero.confirm({ok:"Delete",title:c,msg:"Are you sure you want to delete this app?",onConfirm:function(){d.parents(".card").addClass("deleting");a.api.del(e)}});return false});$q(".save").off("click.paths").on("click.paths",function(){$q(".saving").removeClass("saving");$q(this).parents(".card").addClass("saving");if($q(".alias-wrapper").is(":visible")){$q(".add-alias").click()}a.model.save($q(this));return false});$q(".edit").off("click.pathe").on("click.pathe",function(){var d=$q(this).parents("li:eq(0)").data("id");var c=$q(this);a.api.get(function(e){a.view.renderForm(e,c)},d);return false});$q(".add-alias").off("click.alias").on("click.alias",function(){var d=$q(this).parents(".back");var c=d.find(".alias").is(":visible");if(!c){d.find(".alias-wrapper").show();d.find(".add-alias i").html("&#xF500;");Utils.card.setHeight(this)}else{d.find(".alias-wrapper").hide();d.find(".add-alias i").html("&#xF501;");Utils.card.setHeight(this)}});$q(".add-alias-btn").off("click.aliasb").on("click.aliasb",function(){var e=$q(this).parents(".back");var d=e.find(".alias-wrapper").is(":visible");var c=$q('<div class="row collapse alias" style="display:block;">					<div class="large-12 columns">						<input class="alias-input" type="text" placeholder="http://uat.example.com">						<a class="delete-alias"><i class="ss-delete"></i></a>					</div>				</div>');e.find(".alias-wrapper").append(c);if(!d){e.find("a.add-alias").click()}Utils.card.setHeight(this)});$q("body").off("click.aliasd").on("click.alaisd",".delete-alias",function(){var c=$q(this).parents(".alias-wrapper");$q(this).parents(".alias:eq(0)").remove();Utils.card.setHeight(c);return false});$q(".cancel").off("click.pathc").on("click.pathc",function(){Utils.card.remove($q(this));return false});$q("body").off("change.active").on("change.active","input[type='checkbox']",function(){var c={};c.active=$q(this).is(":checked");var d=$q(this).parents(".app").data("id");a.api.update(c,d)})}};a.api={get:function(d,c){var b={};if(c){b={id:c}}Aero.send(a.model.url,b,function(e){if(d){d(e)}},"GET")},create:function(b,c){Aero.send(a.model.url,b,function(d){if(d){b.id=d;a.view.updateCard(b);Utils.card.flip($q(".saving form"),true,function(){$q(".saving form").remove();$q(".saving").removeClass("saving");if(c){c(d)}})}else{a.view.renderIssue()}},"POST")},update:function(b,d,c){b.id=d;Aero.send(a.model.url,b,function(e){if(e){a.view.updateCard(e);Utils.card.flip($q(".saving form"),true,function(){$q(".saving").removeClass("saving");if(c){c(e)}})}else{a.view.renderIssue()}},"PUT")},del:function(b){Aero.send(a.model.url,{id:b},function(c){Utils.card.remove($q(".deleting"))},"DELETE")}};$q(function(){a.init();var b={};new Utils.menu("#userMenu",b)})});
