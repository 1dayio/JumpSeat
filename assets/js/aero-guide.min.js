"use strict";Aero.model.guide={url:"api/guides",urlSearch:"api/search",defaults:function(){return{title:"",active:false,steps:[]}},byId:function(b,a){Aero.guide.getAll(function(c){$q.each(c,function(e,d){if(d&&(b==d.id)){a(c[e]);localStorage.setItem("aero:session:index",e)}})})},update:function(b,a){Aero.guide.getAll(function(c){Aero.view.guide.render(c);if(b){b(a)}},true)},validate:function(){var a=$q("form").isFormValid();if($q("#aeroEditor").trumbowyg("html").replace(/<br>/g,"")==""){a=false;$q(".trumbowyg-editor").addClass("aero-require-error")}if(!a){$q("#aeroSection0 p:first").after('<div class="aero-error-box">'+AeroStep.lang.requirede+"</div>")}return a}};Aero.view.guide={render:function(c,d,b){var a=this;if(!b){a.clearSearch()}Aero.tpl.get("sidebar-guides.html",function(g){var f=localStorage.getItem("aero:sidebar:open");$q("#aeroGuidebar").remove();var e=_q.template(g);$q("body").append(e({sidebar:f,guides:c}));$q("#aeroStepbar").remove();$q("#aero-tab").css("top",localStorage.getItem("aero:session:tab")+"px");a.setEvents();Aero.view.sidebar.setEvents();Aero.view.sidebar.setScrollable();var h=parseInt($q("body").data("newguides"));if(h>0){Aero.view.sidebar.notify(h)}})},search:function(b){var a=this;$q(".aero-search i").switchClass("fa-search","fa-times",0);$q(".aero-search a").switchClass("aero-search-btn","aero-search-clear",0);Aero.guide.getByTerm(b,function(c){c.search=b;a.render(c,function(){},true)})},clearSearch:function(){if($q(".aero-search-clear").length>0){$q(".aero-search i").switchClass("fa-times","fa-search",0);$q(".aero-search a").switchClass("aero-search-clear","aero-search-btn",0);$q(".aero-search").removeClass("aero-active");$q("input[name=aero_search]").val(AeroStep.lang.search)}},setEvents:function(){var a=this;$q("body").off("click.aeroStart").on("click.aeroStart",".aero-guides ul li > a",function(){var b=$q(this).parents("li:eq(0)").data("guideid");Aero.tip.start(b)});$q("body").off("click.apF").on("focus.apF",".aero-sidebar input[name=aero_search]",function(){$q(this).parents("div:eq(0)").addClass("aero-active");if($q(this).val()==AeroStep.lang.search){$q(this).val("")}});$q("body").off("click.apB").on("blur.apB",".aero-sidebar input[name=aero_search]",function(){if($q(this).val()==""){$q(this).parents("div:eq(0)").removeClass("aero-active");$q(this).val(AeroStep.lang.search)}});$q("body").off("click.aS").on("click.aS",".aero-search a.aero-search-btn",function(){a.search($q("input[name=aero_search]").val())});$q("body").off("keypress.asK").on("keypress.asK",".aero-sidebar input[name=aero_search]",function(c){var b=c.keyCode||c.which;if(b==13){a.search($q(this).val())}});$q("body").off("click.asC").on("click.asC",".aero-search-clear",function(){Aero.guide.getAll(function(b){a.render(b)});return false})}};Aero.guide={init:function(){var b=this;var a=localStorage.getItem("aero:session:end");if(a){Aero.tip.sayCongrats()}b.getAll(function(g){var e=localStorage.getItem("aero:session");var d=window.location.hash.indexOf("guideid=")!=-1;if(e){var c=JSON.parse(e);Aero.tip.start(c.id,parseInt(localStorage.getItem("aero:session:current")))}else{if(d){var h=window.location.hash.split("=").slice(-1)[0];Aero.tip.start(h);window.location.hash=window.location.hash.split("guideid")[0]}else{var f=localStorage.getItem("aero:pathway");if(f&&f!="0"){Aero.pathway.get(function(j){var i=Aero.view.pathway.render(j,parseInt(f));if(!i){Aero.view.guide.render(g)}})}else{Aero.view.guide.render(g)}}}})},autoStart:function(a){if(!a.auto){return}console.log(window.location.pathname);if(a.step.length>0){console.log(a.step[0].url)}},updateCache:function(a){localStorage.setItem("aero:guides",JSON.stringify(a))},getAll:function(e,c){var d=null;var a=localStorage.getItem("aero:guides");var b=localStorage.getItem("aero:cache");if(!b){b=AeroStep.cache}b=parseInt(b);if(b!=AeroStep.cache){d=JSON.parse(a);localStorage.removeItem("aero:guides");a=null}if(!a||c){Aero.log("Loading from SS","success");Aero.send(Aero.model.guide.url,{},function(f){if(d){var g=f.length-d.length;if(g>0){$q("body").data("newguides",g)}}localStorage.setItem("aero:cache",AeroStep.cache);localStorage.setItem("aero:guides",JSON.stringify(f));if(e){e(f)}})}else{Aero.log("Loading from LS","success");e(JSON.parse(a))}},get:function(b,a){Aero.send(Aero.model.guide.url,{id:b},function(c){if(a){a(c)}})},getByTerm:function(a,b){Aero.send(Aero.model.guide.urlSearch,{term:a},function(c){if(b){b(c)}})},create:function(a,b){Aero.send(Aero.model.guide.url,a,function(c){Aero.model.guide.update(b,c)},"POST")},update:function(a,b){Aero.send(Aero.model.guide.url,a,function(){Aero.model.guide.update();if(b){b()}},"PUT")},destroy:function(a){Aero.send(Aero.model.guide.url,{id:a},function(){Aero.model.guide.update()},"DELETE")}};Aero.view.sidebar={setScrollable:function(){var c=$q(window).height()-($q(".aero-head").outerHeight()+$q(".aero-foot").outerHeight());var d=$q(".aero-guide-title").outerHeight();var b=$q(".aero-add-step").length>0?$q(".aero-add-step").outerHeight():0;$q(".aero-guides, .aero-steps").height(c-(d+b))},show:function(a,b){if(!b){b-750}$q(".aero-sidebar").stop().animate({right:"-50px"},b,"easeInOutBack",function(){}).addClass("open");if(a){localStorage.setItem("aero:sidebar:open",1)}},hide:function(a){$q(".aero-sidebar").stop().animate({right:-($q(".aero-sidebar").outerWidth(true))},300,"swing",function(){}).removeClass("open");if($q(".aero-admin-wrapper").length){$q(".aero-admin-wrapper").remove();$q("#aero-tab").css("left","-44px")}$q(".aero-blanket, .aero-edit-active").remove();if(a){localStorage.setItem("aero:sidebar:open",0)}},notify:function(a){$q("#aero-tab").prepend('<span class="aero-not">'+$q("body").data("newguides")+"</span>")},setEvents:function(){var b=this;var a;window.onresize=function(){clearTimeout(a);a=setTimeout(function(){b.setScrollable()},100)};$q("body").off("click.atc").on("click.atc","#aero-tab a",function(){if($q(".aero-sidebar").hasClass("open")){b.hide(true)}else{b.show(true)}});$q("#aero-tab").draggable({axis:"y",distance:10,stop:function(c,d){localStorage.setItem("aero:session:tab",d.offset.top)}});$q(window).off("hashchange.hashn").on("hashchange.hashn",function(){Aero.hashChange=true;AeroStep.ready(function(){setTimeout(function(){Aero.hashChange=false;Aero.guide.init()},500)},AeroStep.required)})}};$q(function(){Aero.guide.init()});