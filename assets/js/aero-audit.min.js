"use strict";Aero.model.audit={key:"aero:session:audit",defaults:function(){return{user:Aero.constants.USERNAME,guideid:Aero.tip._guide.id,pathwayid:Aero.pathway.pathwayid,progress:0,perc:0,timeStart:"",timeStamp:this.getTime(),timeTotal:""}},get:function(){return JSON.parse(localStorage.getItem(this.key))},update:function(a){a.timeStamp=this.getTime();localStorage.setItem(this.key,JSON.stringify(a))},getTime:function(){var a=new Date();return a.getFullYear()+"-"+this.padZero(a.getMonth()+1)+"-"+this.padZero(a.getDate())+" "+this.padZero(a.getHours())+":"+this.padZero(a.getMinutes())+":"+this.padZero(a.getSeconds())},padZero:function(a){return("0"+a).slice(-2)}};Aero.view.audit={timeStart:0,timeTotal:0,setEvents:function(){var a=this;a.startTimer();$q(window).on("beforeunload",function(){Aero.audit.save()});$q(window).on("focus.aerof",function(){Aero.view.audit.startTimer()}).on("blur.aerob",function(){Aero.view.audit.stopTimer()})},removeEvents:function(){$q(window).off("blur.aerob focus.aerof")},startTimer:function(){this.timeStart=new Date().getTime()},stopTimer:function(){var a=new Date().getTime();this.timeTotal=(a-this.timeStart)+this.timeTotal}};Aero.audit={enabled:true,url:"api/audit",id:"",furthestStep:0,init:function(){Aero.audit.furthestStep=0;Aero.view.audit.timeTotal=0;if(!Aero.constants.USERNAME){return}if(typeof Aero.tip._guide==="undefined"||!Aero.tip._guide){return}Aero.view.audit.setEvents();if(localStorage.getItem("aero:session:audit")){return}this.create()},create:function(){if(AeroStep.admin){return}var a=this;var b=Aero.model.audit.defaults();b.timeStart=b.timeStamp;b.timeTotal=Aero.view.audit.timeTotal;Aero.send(this.url,b,function(c){a.id=b.id=c;Aero.model.audit.update(b)},"POST")},update:function(){if(AeroStep.admin){return}var a=Aero.model.audit.get();var b=Aero.tip._current;if(b<this.furthestStep){return}else{this.furthestStep=b}a.progress=(b+1);a.perc=Math.round(((b+1)/Aero.tip._guide.step.length)*100);a.id=this.id;a.timeTotal=Aero.view.audit.timeTotal;Aero.model.audit.update(a)},save:function(b){if(AeroStep.admin){return}var a=Aero.model.audit.get();if(a){Aero.view.audit.stopTimer();a.timeTotal=Aero.view.audit.timeTotal;Aero.view.audit.removeEvents();Aero.send(this.url,a,function(c){self.id=a.id=c;Aero.model.audit.update(a)},"PUT")}if(b){b()}}};