"use strict";Aero.view.step.admin={addNav:function(){$q(".aero-nav-item:first").clone().append('<a class="aero-del-nav">X</a>').insertAfter(".aero-nav-item:last")},destroyNav:function(a){if($q(".aero-nav-item")){a.parents(".aero-nav-item").remove()}},save:function(){var a=parseInt($q(".aero-step-index").val());var b=$q("#editStepFrm").aeroSerialize();b.id=Aero.view.admin.guideid;b.body=$q("#aeroEditor").trumbowyg("html");b.nav={};b.branch=$q("#aeroBranch").val()!=""?$q("#aeroBranch").val():null;if(Aero.host!=location.protocol+"//"+window.location.host){b.cds=location.protocol+"//"+window.location.host}if(b.size_custom!=""&&!isNaN(b.size_custom+"")){b.size=b.size_custom+""}delete b.size_custom;var c=Aero.view.step.admin.quiz.collectAnswers();b.answers=(c.length>0)?c:null;$q(".aero_nav_when").each(function(){if($q(this).val()!=""){b.nav[$q(this).val()]=$q(this).parent().find(".aero_nav_to").val()}});if(b.nav.length==0){delete b.nav}if(b.hide){b[b.hide]=true;delete b.hide}b.showTitle=(b.showTitle=="1")?true:null;b.sidebar=(b.sidebar=="1")?true:null;b.multi=(b.multi=="1")?true:null;b.isRestrict=(b.isRestrict=="1")?true:null;b=_q.pick(b,_q.identity);if($q(".aero-editing-step").hasClass("aero-add-step")){Aero.step.add(b);$q(".aero-helper").remove()}else{Aero.step.update(a,b)}Aero.view.admin.close()},initPicker:function(a){Aero.picker.init({onStart:function(){Aero.tip.hide();Aero.view.sidebar.hide()},callback:function(n){Aero.view.sidebar.show(false,0);Aero.picker.destroy();var i=(Aero.tip._guide.step.length>0)?Aero.tip._current+1:0;var b=[];var l="";var g="";var m="";var o=$q(n).prop("tagName").toLowerCase();var f=["button","a"];if($q.inArray(o,f)>-1){m=$q.trim($q(n).text());g="Click "+m;l=m;b={click:"-1"}}f=["input","select","textarea"];if($q.inArray(o,f)>-1){m=$q.trim($q(n).parent().find("label:eq(0)").text());var k=$q("label[for='"+$q(n).attr("id")+"']");if(k.length>0){m=k.text().replace("*","")}g="Enter "+m;l=m;b={blur:"-1"}}var c=document.URL;var h=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");c=c.replace(h,"");if(!c.match(/#\/$/)){var e=/(\/$|\/#$|#$)/;c=c.replace(e,"")}if(o=="a"){var j=$q(n).attr("href");if(j!="javascript://"&&j!="#"){b={unload:1}}}var d={id:null,title:l,body:g,url:c,isAdd:true,index:i,loc:n,nav:b,loss:"ignore"};if(!a){Aero.view.admin.render("step",$q.extend(Aero.model.step.defaults(),d))}else{$q(".aero-editing").addClass("aero-picking").data("loc",d.loc);$q(".aero-picking a:eq(1)").trigger("click");$q(".aero-picking").removeClass(".aero-picking")}}});Aero.picker.setEvents()},renderSortable:function(){$q(".aero-steps ul").sortable({placeholder:"aero-helper-dropable",update:function(a,b){Aero.step.moveIndex(Aero.moveFrom,b.item.index());Aero.moveFrom=null},start:function(a,b){Aero.moveFrom=b.item.index()}}).disableSelection()},setEvents:function(){var a=this;$q("body").off("click.aroSD").on("click.aroSD",".aero-steps ul li a.aero-delete",function(){var b=$q(".aero-steps li").index($q(this).parents("li:eq(0)"));Aero.confirm({ok:"Delete",title:"Step delete",msg:"Are you sure you want to delete this step?",onConfirm:function(){Aero.step.destroy(b)}});return false});$q("body").off("click.aeroLocE").on("click.aeroLocE","a.aero-edit-loc",function(){Aero.view.step.admin.initPicker(true);return false});$q("body").off("click.aeroSEdit").on("click.aeroSEdit",".aero-steps ul li a.aero-edit",function(){var c=$q(this).parents("li:eq(0)");var b=(c.data("loc"))?c.data("loc"):false;Aero.index=$q(".aero-steps li").index(c);Aero.view.admin.edit($q(this),b);return false});$q("body").off("keypress.ssa").on("keypress.ssa","#editStepFrm input:not(.aero-input-label)",function(c){var b=c.keyCode||c.which;if(b=="13"){if(Aero.model.step.validate()){a.save()}return false}});$q("body").off("click.aeroSSave").on("click.aeroSSave",".aero-editing-step .aero-btn-save",function(){if(Aero.model.step.validate()){a.save();return false}});$q("body").off("click.aeroTab").on("click.aeroTab",".aero-tab a",function(){var b="aero-tab-active";var c=$q(this).parents(".aero-section");c.find("."+b).removeClass(b);c.find($q(this).attr("href")).addClass(b);$q(this).addClass(b);if($q(this).attr("id")=="aero-section-quiz"){Aero.view.step.admin.quiz.render()}return false});$q("body").off("click.aeroNAdd").on("click.aeroNAdd",".aero-editing-step .aero-add-nav",function(){a.addNav();return false});$q("body").off("click.aeroNDel").on("click.aeroNDel",".aero-editing-step .aero-del-nav",function(){a.destroyNav($q(this));return false});$q("body").off("change.ssC").on("change.ssC",".aero-section select[name='aero_size']",function(){$q(".aero-custom-size").hide();$q(".aero-custom-size input").val("");if($q(this).val()=="custom"){$q(".aero-custom-size").show()}});$q("body").off("change.seC").on("change.seC",".aero-section select[name='aero_miss']",function(){$q(".aero-alert-edit, .aero-skip-edit").hide();$q('input[name="aero_alert"], input[name="aero_alertContent"]').val("");if($q(this).val()=="alert"){$q(".aero-alert-edit").show()}if($q(this).val()=="skipto"){$q(".aero-skip-edit").show()}});$q("body").off("change.seL").on("change.seL",".aero-section select[name='aero_loss']",function(){$q(".aero-loss-alert-edit, .aero-loss-skip-edit").hide();$q('input[name="aero_lossalert"], input[name="aero_lossalertContent"]').val("");if($q(this).val()=="alert"){$q(".aero-loss-alert-edit").show()}if($q(this).val()=="skipto"){$q(".aero-loss-skip-edit").show()}});$q("body").off("change.lut").on("change.lut",".aero-section input[name='aero_locText']",function(){var f,d,c,b,e;f=$q("input[name='aero_loc']").val();c=$q(f);b=c.prop("tagName");if(b!="A"&&b!="BUTTON"&&b!="LABEL"){return}e=f.split(">");e=e.slice(0,-1);if($q(this).is(":checked")){d=e.join(">")+"> "+b.toLowerCase()+":contains('"+c.text().trim()+"')"}else{d=e.join(">")+"> "+b.toLowerCase()+":eq("+$q(e.join(">")+"> "+b.toLowerCase()).index(c)+")"}$q("input[name='aero_loc']").val(d)});$q("body").on("mouseup","a.aero-btn-picker",function(){$q(".aero-play-icon").remove();a.initPicker()}).on("click","a.aero-btn-picker",function(){return false})}};