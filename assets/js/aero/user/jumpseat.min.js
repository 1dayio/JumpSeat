"use strict";var Aero={constants:{PATH:AeroStep.baseUrl,USERNAME:AeroStep.getUsername()},model:{},view:{},host:AeroStep.host,send:function(b,d,e,c){if(!c){c="GET"}if(!d.host){d.host=this.host}if(c=="POST"||c=="PUT"){d=JSON.stringify(d)}b=this.constants.PATH+b;var a={async:false,type:c,data:d,dataType:"json",contentType:"application/json",url:b,success:function(f){if(e){e(f)}},error:function(h,g){var f=b+" says: "+JSON.stringify(h)+" "+JSON.stringify(g);Aero.log(JSON.stringify(f))}};if(c=="GET"){a.dataType="jsonp"}$q.ajax(a)},log:function(b,a){if(!AeroStep.debug){return}if(a){switch(a){case"error":console.log("%c"+b,"background: #ea8181; color: #333");break;case"warn":console.log("%c"+b,"background: #eac481; color: #333");break;case"success":console.log("%c"+b,"background: #8eea81; color: #333");break;case"info":console.log("%c"+b,"background: #81d7ea; color: #333");break}}else{console.log(b)}}};Aero.confirm=function(d){var c;var g={ok:AeroStep.lang.ok,cancel:AeroStep.lang.cancel,title:"",msg:"",confirm:false,onConfirm:function(){},onCancel:function(){},onValidate:function(){return true}};$q.extend(g,d);function b(){Aero.tpl.get("modal.html",function(i){var h=_q.template(i);$q("body").append(h({msg:g}));c=$q(".aero-modal").hide();g.height=c.outerHeight();c.css({top:($q(window).height()/2)-(g.height/2),left:($q(window).width()/2)-(c.outerWidth()/2)});$q(".aero-backdrop").fadeTo(200,0.5,function(){c.show();$q(".aero-modal-body").find("input:eq(0)").focus()});f(g.onConfirm)})}function e(){c=$q(".aero-modal");c.animate({top:-(g.height)},300,function(){$q(".aero-backdrop, .aero-modal").fadeTo(200,0).remove()})}function a(){if(g.onValidate()){g.onConfirm();e()}}function f(){$q("body").off("keyup.smw").on("keyup.smw",function(i){var h=i.keyCode||i.which;if(h=="27"){g.onCancel();e()}});$q("body").off("click.confok").on("click.confok",".aero-btn-ok",function(){a()});$q("body").off("click.confc").on("click.confc",".aero-btn-no",function(){g.onCancel();e()});$q(".aero-modal").off("keypress.confk").on("keypress.confk",function(i){var h=i.keyCode||i.which;if(h=="13"){a();return false}})}b()};Aero.tpl={templates:{},get:function(b,e){var a=this;var d="api/template";var c={name:b,guest:Aero.constants.USERNAME};if(a.templates[b]){if(e){e(a.templates[b])}return}Aero.send(d,c,function(f){var g=JSON.parse(f);Aero.tpl.templates[b]=g.tpl;if(e){e(a.templates[b])}})}};$q.fn.aeroSerialize=function(){var c={};var b=this.serializeArray();$q.each(b,function(){var a=this.name.replace("aero_","");if(c[a]!==undefined){if(!c[a].push){c[a]=[c[this.name]]}c[a].push(this.value||"")}else{c[a]=this.value||""}});return c};$q.fn.isFormValid=function(){var a=[];$q(".aero-require-error").removeClass("aero-require-error");$q(".aero-error-box").remove();$q(this).find(".aero-required").each(function(){$q(this).removeClass("aero-require-error");if($q(this).val()==""){if(a.length==0){a.push(AeroStep.lang.requirede)}$q(this).addClass("aero-require-error")}});if(a.length>0){if($q(".aero-modal form:eq(0)").length>0){$q(".aero-modal form:eq(0)").prepend('<div class="aero-error-box"><ul><li>'+a.join("</li><li>")+"</li></ul></div>")}return false}return true};$q.fn.visible=function(k){var d=$q(window);var g=this.length>1?this.eq(0):this,m=g.get(0),f=d.width(),l=d.height();if(typeof m.getBoundingClientRect==="function"){var e=m.getBoundingClientRect(),i=e.top>=0&&e.top<l,c=e.bottom>0&&e.bottom<=l,j=e.left>=0&&e.left<f,a=e.right>0&&e.right<=f,h=k?i||c:i&&c,b=k?j||a:j&&a;return h&&b}};(function(b){var a=b.fn.on,c;b.fn.on=function(){var e=Array.apply(null,arguments);var g=e[e.length-1];if(isNaN(g)||(g===1&&e.pop())){return a.apply(this,e)}var d=e.pop();var f=e.pop();e.push(function(){var h=this,i=arguments;clearTimeout(c);c=setTimeout(function(){f.apply(h,i)},d)});return a.apply(this,e)}}(this.$q));if(!Object.keys){Object.keys=function(c){var b=[];for(var a in c){if(c.hasOwnProperty(a)){b.push(a)}}return b}}if(typeof aerofire!=="undefined"){aerofire.init()};"use strict";Aero.model.audit={key:"aero:session:audit",defaults:function(){return{user:Aero.constants.USERNAME,guideid:Aero.tip._guide.id,pathwayid:Aero.pathway.pathwayid,progress:0,perc:0,timeStart:"",timeStamp:this.getTime(),timeTotal:""}},get:function(){return JSON.parse(aeroStorage.getItem(this.key))},update:function(b){var a=JSON.parse(aeroStorage.getItem(this.key));if(a&&a.id!=""&&b.id==""){b.id=a.id}b.timeStamp=this.getTime();aeroStorage.setItem(this.key,JSON.stringify(b))},getTime:function(){var a=new Date();return a.getFullYear()+"-"+this.padZero(a.getMonth()+1)+"-"+this.padZero(a.getDate())+" "+this.padZero(a.getHours())+":"+this.padZero(a.getMinutes())+":"+this.padZero(a.getSeconds())},padZero:function(a){return("0"+a).slice(-2)}};Aero.view.audit={timeStart:0,timeTotal:0,setEvents:function(){var a=this;a.startTimer();$q(window).on("beforeunload",function(){Aero.audit.save()});$q(window).on("focus.aerof",function(){Aero.view.audit.startTimer()}).on("blur.aerob",function(){Aero.view.audit.stopTimer()})},removeEvents:function(){$q(window).off("blur.aerob focus.aerof")},startTimer:function(){this.timeStart=new Date().getTime()},stopTimer:function(){var a=new Date().getTime();this.timeTotal=(a-this.timeStart)+this.timeTotal}};Aero.audit={enabled:true,url:"api/audit",id:"",furthestStep:0,init:function(){Aero.audit.furthestStep=0;Aero.view.audit.timeTotal=0;if(!Aero.constants.USERNAME){return}if(typeof Aero.tip._guide==="undefined"||!Aero.tip._guide){return}Aero.view.audit.setEvents();if(aeroStorage.getItem("aero:session:audit")){return}this.create()},create:function(){if(AeroStep.admin){return}var a=this;var b=Aero.model.audit.defaults();b.timeStart=b.timeStamp;b.timeTotal=Aero.view.audit.timeTotal;Aero.send(this.url+"/create",{data:JSON.stringify(b)},function(c){a.id=c;b.id=c;Aero.model.audit.update(b)},"GET")},update:function(){if(AeroStep.admin){return}var a=Aero.model.audit.get();var b=Aero.tip._current;if(b<this.furthestStep){return}else{this.furthestStep=b}a.progress=(b+1);a.perc=Math.round(((b+1)/Aero.tip._guide.step.length)*100);a.id=this.id;a.timeTotal=Aero.view.audit.timeTotal;Aero.model.audit.update(a)},save:function(b){if(AeroStep.admin){return}var a=Aero.model.audit.get();if(a){Aero.view.audit.stopTimer();a.timeTotal=Aero.view.audit.timeTotal;Aero.view.audit.removeEvents();Aero.send(this.url+"/create",{data:JSON.stringify(a)},function(c){Aero.model.audit.update(a)},"GET")}if(b){b()}}};"use strict";Aero.model.pathway={url:"api/pathway"};Aero.view.pathway={render:function(a,b){$q(".aero-here").remove();$q(".ae-here").removeClass("ae-here");try{var d=a[b].title;var e=a[b].id;if(b==0){Aero.guide.getAll(function(f){Aero.view.guide.render(f)})}else{if(b==a.length-1){Aero.onpage.getGuides(function(f){f[0].path="On This Page";Aero.view.guide.render(f)})}else{Aero.pathway.getGuides(e,function(f){f[0].path=d;f[0].pathid=e;Aero.view.guide.render(f)})}}aeroStorage.setItem("aero:pathway",b);aeroStorage.setItem("aero:pathway:name",d);return true}catch(c){return false}},setEvents:function(){var a=this;$q("body").off("click.aeropath").on("click.aeropath",'.aero-carousel a:not(".aero-share")',function(){var b=$q(this).hasClass("aero-left");Aero.pathway.get(function(f){var g=null;var c=aeroStorage.getItem("aero:pathway");var e=f.length-1;var d=c?c:0;if(b){d--}else{d++}if(d<0){d=e}if(d>e){d=0}a.render(f,d)});return false})}};Aero.pathway={init:function(){Aero.view.pathway.setEvents()},get:function(c,b){if(Aero.constants.PATHWAYS){c(Aero.constants.PATHWAYS);return}var a={};a.dropEmpty=true;a.count=true;a.select=["title"];if(b){a={id:b}}Aero.send(Aero.model.pathway.url,a,function(d){d.unshift({title:AeroStep.lang.allguides});d.push({title:"On This Page"});Aero.constants.PATHWAYS=d;if(c){c(d)}},"GET")},getGuides:function(a,b){if(!Aero.constants.pathway){Aero.constants.pathway={}}if(Aero.constants.pathway&&Aero.constants.pathway[a]){b(Aero.constants.pathway[a]);return}Aero.send("api/pathwaymap/by_pathway",{active:true,pathwayid:a},function(c){Aero.constants.pathway[a]=c;if(b){b(c)}},"GET")}};Aero.onpage={getGuides:function(d){var c=this;var a=[];var b=d;Aero.guide.getAll(function(f){for(var e in f){var g=f[e].step[0];if(g){if(g.position&&g.position=="orphan"){g=f[e].step[1]}if(g.loc=="body"){break}if(g.noUrl=="all"||g.url==AeroStep.getSubURL(window.location.pathname)){a.push(f[e])}}}if(d){d(a)}c.render(a)})},render:function(d){$q(".aero-here").remove();$q(".ae-here").removeClass("ae-here");var f=0;for(var b in d){if(d[b]){var e,a,g,c;e=d[b].step[0];if(e.position&&e.position=="orphan"){e=d[b].step[1]}a=$q(e.loc);g=a.offset();if(a&&!a.hasClass("ae-here")){a.addClass("ae-here").data("ae-id",f);c=$q('<a id="ae-id-'+f+'" class="aero-here">X</a>');c.css({top:g.top-20,left:g.left-37}).data("guideids",d[b].id);$q("body").append(c);f++}this.setEvents()}}},setEvents:function(){$q(".aero-here").off("click.aeop").on("click.aeop",function(){Aero.tip.start($q(this).data("guideids"));$q(".aero-here").remove()})}};"use strict";Aero.view.quiz={tpl:function(a){return'<li class="clearfix"><label><input data-ans="'+a.correct+'" type="checkbox" value="1"/>'+a.title+"</label></li>"},render:function(d,c){c=c?c:"";var b='<div class="aero-quiz aero-quiz-'+c+'"><ul class="clearfix">';for(var a in d){if(!$q.isFunction(d[a])){b+=this.tpl(d[a])}}b+="</ul></div>";return b},renderNotification:function(a,c,b){var d="";switch(b){case"err":d='<i class="fa fa fa-warning"></i>Incorrect Answer!';if(c&&c!=""){d+="<div>"+c+"</div>"}break;case"warn":d='<i class="fa fa fa-warning"></i>Please select an answer!';break;case"success":d='<i class="fa fa-check-square-o"></i> Correct!';break}$q(".aero-msg").remove();a.find(".aero-tip-body").prepend('<div class="aero-msg aero-'+b+'">'+d+"</div>")},validate:function(c){var b=true;var a=0;$q("#"+c.id).find("input").each(function(){if($q(this).is(":checked")){a=a+1}if($q(this).data("ans")!=$q(this).is(":checked")){b=false}});if(a==0){this.renderNotification($q("#"+c.id),null,"warn")}else{if(!b){this.renderNotification($q("#"+c.id),c.errmsg,"err")}else{this.renderNotification($q("#"+c.id),null,"success")}}return b}};"use strict";Aero.view.media={tpl:function(d,e){var c=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;var b=d.match(c);var a=e?(e*0.6)+"px":"100%";if(b&&b[2].length==11){return'<iframe width="100%" height="'+a+'" src="//www.youtube.com/embed/'+b[2]+'" frameborder="0" allowfullscreen></iframe>'}else{return"error"}},render:function(a){if(a.youtube){return this.tpl(a.youtube,a.size)}else{if(a.embed){return a.embed}}}};"use strict";Aero.model.step={url:"api/steps",defaults:function(a){var b=a+1;if(Aero.tip._guide.step){b=(a===Aero.tip._guide.step.length-1)?-1:a+1}return{loc:"",tries:3,position:"bottom",id:"astep-"+a,next:b,prev:a-1}},update:function(a){aeroStorage.getItem("aero:session:index",function(c){var b=JSON.parse(aeroStorage.getItem("aero:guides"));c=parseInt(c);b[c]=a;aeroStorage.setItem("aero:guides",JSON.stringify(b));aeroStorage.setItem("aero:session",JSON.stringify(b[c]),function(){},true);Aero.tip.setGuide(a.id);Aero.view.step.render(b[c])},true)},validate:function(){var b=$q("form").isFormValid();if($q("#aeroEditor").trumbowyg("html").replace(/<br>/g,"")==""){b=false;$q(".trumbowyg-editor").addClass("aero-require-error")}if(!b){$q("#aeroSection0 p:first").after('<div class="aero-error-box">'+AeroStep.lang.requirede+"</div>");var a=$q(".aero-require-error:eq(0)").parents(".aero-tab-content:eq(0)");if(a){a.parent().find('a[href="#'+a.attr("id")+'"]').click()}}return b}};Aero.view.step={render:function(a){var b=this;Aero.tpl.get("sidebar-steps.html",function(c){aeroStorage.getItem("aero:sidebar:open",function(e){$q("#aeroStepbar").remove();var d=_q.template(c);$q("body").append(d({sidebar:e,g:a}));$q("#aeroGuidebar").remove();$q("#aero-tab").css("top",aeroStorage.getItem("aero:session:tab")+"px");b.setEvents();Aero.view.sidebar.setScrollable()},true)});Aero.view.sidebar.setEvents()},renderShare:function(a){$q("body").append('<div class="aero-share-tip"><span></span><input type="text" value="'+a+'" /></div>');$q(".aero-share-tip input").select()},setState:function(a,b){if(!a){a=Aero.tip._current}if(b){$q(".aero-steps li:eq("+a+")").addClass("aero-"+b)}else{var c=$q(".aero-steps li:eq("+a+")");c.addClass("aero-active");c.removeClass("aero-forward aero-missing");aeroStorage.removeItem("aero:session:forward",function(){},true)}},setEvents:function(){var a=this;if(AeroStep.admin){$q("body").off("click.sa").on("click.sa",".aero-steps li > a",function(){Aero.tip.jumpTo($q(".aero-steps li").index($q(this).parent()))})}$q("body").off("click.sas").on("click.sas","a.aero-stop",function(){Aero.tip.stop()});$q("body").off("click.ashare").on("click.ashare","a.aero-share",function(){a.renderShare(Aero.host+$q(this).data("link"));return false});$q(document).click(function(b){if($q(b.target).hasClass("aero-share-tip")||$q(b.target).parent().hasClass("aero-share-tip")){return}$q(".aero-share-tip").remove()});if(AeroStep.admin){setTimeout("if(Aero.view.step.admin) Aero.view.step.admin.renderSortable();",100)}}};Aero.step={get:function(b){try{var a=new Aero.model.step.defaults(b);return $q.extend({},a,Aero.tip._guide.step[b])}catch(c){AeroStep.session.destroy();location.reload(true)}},add:function(a,b){a.id=Aero.tip._guide.id;a.insertAt=Aero.tip._current;Aero.send(Aero.model.step.url,a,function(e){Aero.model.step.update(e);var d=Aero.tip._current+1;var c=Aero.tip._guide.step.length==0?0:d;Aero.tip.jumpTo(c);if(b){b(e)}},"POST")},update:function(a,b,c){b.id=Aero.tip._guide.id;b.index=a;Aero.send(Aero.model.step.url,b,function(d){Aero.model.step.update(d);Aero.tip.show();if(c){c(d)}},"PUT")},moveIndex:function(b,a){Aero.send(Aero.model.step.url+"/move",{id:Aero.tip._guide.id,from:b,to:a},function(c){Aero.model.step.update(c)},"PUT")},destroy:function(a,b){Aero.send(Aero.model.step.url,{id:Aero.tip._guide.id,index:a},function(c){Aero.model.step.update(c);if(a==Aero.tip._current){Aero.tip.next()}if(b){b(c)}},"DELETE")}};"use strict";Aero.tip={options:{labels:{end:AeroStep.lang.finished,next:AeroStep.lang.next,prev:AeroStep.lang.prev},template:function(e){var j="",h="",b="",d="";var f=e.position?e.position:"top";var c=parseInt(Aero.tip._current)+1;var g=Aero.tip._guide.step.length;var i=(c/g)*100;if(isNaN(e.size)){j=(e.size&&e.size!="")?" aero-tip-"+e.size:""}else{j="' style='width:"+e.size+"px'"}if(e.showTitle){h='<div class="aero-tip-title">'+e.title+"</div>"}var a=e.multi?"":"<div class='aero-tip-nav clearfix'><div class='aero-progress'><span>"+c+" of "+g+"</span><span class='aero-needle'><span style='width:"+i+"%'></span></span></div></div>";if(e.answers&&e.answers.length>0){b=Aero.view.quiz.render(e.answers,e.quizsize)}if(e.embed||e.youtube){d=Aero.view.media.render(e)}return"<div id='"+e.id+"' class='aero-tip aero-tip-"+f+j+"' style='display:none'><div class='aero-tip-arrow'></div><div class='aero-tip-body'>"+h+e.body+b+d+"</div>"+a+"</div>"}},spotlight:function(g,e){return;var b,d,f,a,c;b=$q(e.loc);b.addClass("ae-showElement ae-relativePosition");f=b.outerWidth()+10;a=b.outerHeight()+10;c=b.offset();d=$q('<div class="aero-remove ae-overlay" style="top: 0;bottom: 0; left: 0;right: 0;position: fixed;opacity: 0.8;"></div>');$q("body").append(d);d=$q("<div />").addClass("aero-remove ae-helperLayer").css({width:f,height:a,top:c.top-5,left:c.left-5});$q("body").append(d)},setGuide:function(c,b){var a=this;a._guide=false;aeroStorage.getItem("aero:session",function(d){if(d){a._guide=JSON.parse(d);Aero.view.step.render(a._guide);if(b){b()}}else{Aero.model.guide.byId(c,function(e){a._guide=e;Aero.view.step.render(a._guide);aeroStorage.setItem("aero:session",JSON.stringify(a._guide),function(){if(b){b()}},true)})}},true)},setStep:function(a,b){this._current=a;if(!b){aeroStorage.setItem("aero:session:current",a,function(){},true)}},redirect:function(a,j,k){var d=false;var e=/#$/;var c=/\/$/;var i=document.URL;var h=false;var b=(h||aeroStorage.override)?Aero.host:location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");var g=k?k:b;if(a=="/#/"){d=true}if(!a){a=""}a=g+a;if(!d){if(e.test(i)){i=i.replace("#","")}if(c.test(i)){i=i.slice(0,-1)}}a=AeroStep.getSubURL(a);if(j=="all"){return false}if(j=="par"){i=i.split("?")[0];a=a.split("?")[0]}if(j=="anc"){i=i.split("#")[0];a=a.split("#")[0]}if(i!=a){var f=aeroStorage.getItem("aero:session:404");var l=(f)?(parseInt(f)+1):0;aeroStorage.setItem("aero:session:404",l);if(l>1){Aero.confirm({ok:AeroStep.lang.done,title:AeroStep.lang.notfound,msg:AeroStep.lang.urlloop+"</br></br><strong>"+a+"</strong>",onConfirm:function(){Aero.tip.stop()}})}else{window.location=a}return true}return false},validate:function(){var b=true;var a=Aero.step.get(this._current);if(a.answers&&a.answers.length>0){b=Aero.view.quiz.validate(a)}return b},start:function(d,c){var b=c?c:0;var a=this;aeroStorage.getItem("aero:session:cds",function(e){if(!e){aeroStorage.setItem("aero:session:cds",Aero.host,function(){},true)}else{Aero.host=e}a._forward=true;a.setGuide(d,function(){if(Aero.constants.USERNAME){Aero.audit.init()}a.setNav();a.setStep(b);$q(".aero-restrict").remove();a.beforeShow(b,Aero.step.get(a._current))})},true)},stop:function(){if(!this.validate()){return}aeroStorage.setItem("aero:cache",0);var a=this.isReturnBranch();if(!a){if(Aero.tip._guide.step&&Aero.tip._current==(Aero.tip._guide.step.length-1)){this.sayCongrats()}this.setStep(null);this.hide(this._current);clearInterval(this.ob);Aero.tip._guide=null;AeroStep.session.destroy();Aero.guide.init()}},next:function(){if(!this.validate()){return}var a=Aero.step.get(this._current);this._forward=true;clearInterval(this.ob);aeroStorage.removeItem("aero:session:fake");if(a.next!=-1){this.hide(this._current);this.beforeShow(a.next,a)}},prev:function(){var a=Aero.step.get(this._current);this._forward=false;clearInterval(this.ob);aeroStorage.removeItem("aero:session:fake");if(a.prev!=-1){this.hide(this._current);this.beforeShow(a.prev,a)}},jumpTo:function(a){var b=Aero.step.get(a);this._forward=true;clearInterval(this.ob);Aero.jump=true;aeroStorage.removeItem("aero:session:fake");if(b){this.hide(this._current);this.beforeShow(a,b)}},findStep:function(b){var a=false;if(b.loc){a=b.isFrame?$q(b.framePath).contents().find(b.loc):$q(b.loc);if(a.length===0||!a.is(":visible")||a.css("visibility")=="hidden"){a=false}}return a},findStepTimeout:function(d,b){var a=this;if(Aero.hashChange){return}if(a.tries<d*2){Aero.timeFindStep=setTimeout(function(){a.hide(b-1);a.show(b);a.tries++},500)}else{clearTimeout(Aero.timeFindStep);var c=Aero.step.get(b);Aero.view.step.setState(b,"missing");if(c.miss=="alert"){this.renderException(c.alert,c.alertContent,true)}else{if(c.miss=="back"){Aero.view.step.setState(b,"missing");this.prev()}else{if(c.miss=="skip"){a.show(b+1)}else{if(c.miss=="skipto"){a.jumpTo(c.skipto);for(var b=Aero.tip._current;b<=c.skipto-1;b++){Aero.view.step.setState(b,"missing")}}else{this.renderException("Step is Missing","Sorry, we can't find that step - to fix this try: <ul><li>Using a more generic element</li><li>Use 'next item visible' for the navigation on your previous step</li><li>Increase the wait timer for finding this step</li></ul>")}}}}}},observe:function(b){var a=this;Aero.log("Observe","info");var c=Aero.step.get(b);a.ob=setInterval(function(){Aero.log("Observing","info");var d=a.findStep(c);if(d){a.next()}if(d||b!=a._current+1){clearInterval(a.ob)}},500)},beforeShow:function(i,step){var self=this;self.tries=1;var wait=200;var before=(this._forward)?step.beforeCode:this._guide.step[i].beforeCode;if(step.pause){wait=parseInt(step.pause)*1000}if(before){try{eval(before)}catch(err){Aero.log("Before show code is broken: "+err,"error")}}setTimeout(function(){if(!Aero.hashChange){self.show(i)}},wait)},show:function(b,g){var f,a,c;if(Aero.tip._guide.step.length==0){return}if(typeof b=="undefined"){b=this._current}if(!Aero.tip._guide||b>Aero.tip._guide.step.length||b<0){return}aeroStorage.setItem("aero:session:forward",true);c=Aero.step.get(b);if(c.sidebar){Aero.view.sidebar.hide()}else{aeroStorage.getItem("aero:sidebar:open",function(d){if(!$q(".aero-sidebar").hasClass("open")&&d=="1"){Aero.view.sidebar.show()}},true)}a=this.findStep(c,b);this.setStep(b,g);if(AeroStep.admin&&aeroStorage.getItem("aero:session:fake")&&aeroStorage.getItem("aero:session:forwardUrl")!==document.URL){Aero.view.step.setState(aeroStorage.getItem("aero:session:fake"),"forward");return}else{if(this.redirect(c.url,c.noUrl,c.cds)){return}}aeroStorage.removeItem("aero:session:404");if(a){Aero.log("Found Step "+b,"success");Aero.audit.update();if(AeroStep.admin){aeroStorage.setItem("aero:sidebar:cdshost",b+"~"+window.location.host,function(){},true);aeroStorage.setItem("aero:session:fake",b);aeroStorage.setItem("aero:session:forwardUrl",document.URL)}if(c.branch){c.position="orphan";c.size=500}f=$q(this.options.template(c));if(c.branch){f=this.renderBranch(f,c.branch,c.branchstep,c["return"])}else{f=this.buildNav(f,c)}$q(".ae-active-el").removeClass("ae-active-el");a.addClass("ae-active-el");$q("body").append(f);Aero.view.step.setState(b);this.setPosition(a,f,c.position);this.setEvents(a,c.nav,f,c.position);this.scrollToElement(a)}else{if(c.tries&&c.tries>0){this.findStepTimeout(c.tries,b);return}else{if(!c.multi){Aero.log("Skipping step: "+b+" with loc:"+c.loc,"error");Aero.view.step.setState(b,"missing");if(b<Aero.tip._guide.step.length){if(this._forward){this.next()}else{this.prev()}}}}}var e=(this._forward)?1:-1;var h=false;if(this._forward&&Aero.step.get(b+e).multi||!this._forward&&c.multi){h=true}if(Aero.jump&&c.multi){h=true;e=-1;this._forward=false}if(h){this.show(b+e,true)}Aero.jump=null},hide:function(i){var step=Aero.step.get(i);$q(".aero-active, .aero-showElement").removeClass("aero-active aero-showElement aero-relativePosition");$q(".aero-tip, .aero-remove").remove();if(step.afterCode){try{eval(step.afterCode)}catch(err){Aero.log("After hide code is broken: "+err,"error")}}},buildNav:function(c,d){var e="";var b=false;for(var a in d.nav){if(d.nav.click!=undefined||d.nav.hover!=undefined){b=true}}if(!d.noNav){if(d.next==-1){e+="<a class='aero-btn-end'>"+this.options.labels.end+"</a>"}if(!d.noNext&&!b&&d.next!=-1){e+="<a class='aero-btn-next'>"+this.options.labels.next+"</a>"}if(!d.noPrev&&d.prev!=-1){e+="<a class='aero-btn-prev'>"+this.options.labels.prev+"</a>"}}c.find(".aero-tip-nav").append(e);return c},setPosition:function(j,b,c){var h={};var a=j.offset();var e=b.outerWidth()/2;var d=b.outerHeight();var i=a.left+(j.outerWidth()/2);var g=a.top+(j.outerHeight()/2);var f=b.find(".aero-tip-arrow");h.tLeft=e-(f.outerWidth()/2);h.tTop=(b.outerHeight()/2)-(f.outerHeight()/2);switch(c){case"top":h.left=i-e;h.top=a.top-d-b.find(".aero-tip-arrow").outerHeight();break;case"bottom":h.left=i-e;h.top=a.top+j.outerHeight();break;case"left":h.left=a.left-b.outerWidth()-b.find(".aero-tip-arrow").outerWidth();h.top=g-(d/2);break;case"right":h.left=a.left+j.outerWidth();h.top=g-(d/2);break;case"orphan":h.left=$q(window).width()/2-e;h.top=$q(window).height()/2-(d/2);break}h=this.containIn(document,b,h,c);$q(".aero-tip-top, .aero-tip-bottom").each(function(){f.css({left:h.tLeft})});$q(".aero-tip-left, .aero-tip-right").each(function(){f.css({top:h.tTop})});$q(".aero-tip-top").each(function(){f.css({top:"auto"})});b.css({left:h.left,top:h.top})},containIn:function(b,f,h,g){var d=$q(b).height();var i=$q(window).width();var e=h.left+f.outerWidth()-i;var c=h.top+f.outerHeight()-d;if(e>0){if(g=="bottom"||g=="top"){h.tLeft+=e}h.left-=e}if(h.left<0){if(g=="bottom"||g=="top"){h.tLeft+=h.left}h.left-=h.left}if(h.top<0){if(g=="left"||g=="right"){h.tTop+=h.top}h.top-=h.top}if(c>0&&g=="bottom"){if(g=="left"||g=="right"){h.tTop+=c}h.top-=c}var a=h.left+f.outerWidth();if(a>(i-270)){aeroStorage.getItem("aero:sidebar:open",function(j){Aero.view.sidebar.hide()},true)}else{aeroStorage.getItem("aero:sidebar:open",function(j){if(j=="1"){Aero.view.sidebar.show()}},true);if(g=="orphan"){h.left-=115}}return h},scrollToElement:function(a){var b=$q(".aero-tip:eq(0)");b.show();if(!a.visible()){$q("body, html").stop().animate({scrollTop:b.offset().top-($q(window).height()/2)+(b.height())},750,function(){$q(".aero-tip").fadeIn(200)});b.hide()}else{b.hide();$q(".aero-tip").fadeIn(200)}$q(".aero-tip").fadeIn(200)},isReturnBranch:function(){var b=aeroStorage.getItem("aero:session:branch:returnid");var a=aeroStorage.getItem("aero:session:branch:returnto");if(!b){return false}aeroStorage.removeItem("aero:session:branch:returnid");aeroStorage.removeItem("aero:session:branch:returnto");Aero.confirm({ok:"Return",cancel:"End Guide",title:"Branch complete",msg:"You have completed this branch, we will now move you back to the original guide.",onConfirm:function(){Aero.tip.hide();Aero.tip.start(b,parseInt(a))},onCancel:function(){Aero.tip.stop()}});return true},renderBranch:function(e,b,d,c){var a=e.find(".aero-tip-body").html();e.find(".aero-tip-body").html("Please select one of the following choices: <div class='aero-branch'><a data-returnid='"+Aero.tip._guide.id+"' data-returnto='"+c+"' data-guideid='"+b+"' class='aero-start'>"+a+"</a><a class='aero-continue'>Continue with this guide</a></div>");return e},renderException:function(c,a,b){Aero.confirm({ok:"End Guide",cancel:b?"Go Back":"Ok",title:c,msg:a,onConfirm:function(){Aero.tip.stop()},onCancel:function(){if(b){Aero.tip.prev()}}})},setNav:function(){var a=this;$q("body").off("click.aNe").on("click.aNe",".aero-btn-next",function(){a.next()}).off("click.aPe").on("click.aPe",".aero-btn-prev",function(){a.prev()}).off("click.aEd").on("click.aEd",".aero-btn-end",function(){a.stop()})},sayCongrats:function(){aeroStorage.getItem("aero:session",function(b){var a=JSON.parse(b);if(!AeroStep.admin){Aero.confirm({ok:AeroStep.lang.done,title:AeroStep.lang.gfinished,msg:AeroStep.lang.congrats+a.title,onConfirm:function(){AeroStep.session.destroy()}})}},true)},setEvents:function(c,f,e,a){var b=this,d=false;$q(document).off("scroll.scw").on("scroll.scw"+Aero.tip._current,function(){b.setPosition(c,e,a)},250);$q("div *").off("scroll.scd").on("scroll.scd"+Aero.tip._current,function(){b.setPosition(c,e,a)},250);$q(window).on("resize",function(){b.setPosition(c,e,a);Aero.view.sidebar.setScrollable()},250);aeroStorage.removeItem("aero:session:end");if(Aero.tip._current==(Aero.tip._guide.step.length-1)){aeroStorage.setItem("aero:session:end",1);d=true}$q("body").off("click.branchc").on("click.branchc",".aero-continue",function(){Aero.tip.next()});$q("body").off("click.branchs").on("click.branchs",".aero-start",function(){aeroStorage.setItem("aero:session:branch:returnid",$q(this).data("returnid"));aeroStorage.setItem("aero:session:branch:returnto",$q(this).data("returnto"));Aero.tip.hide();Aero.tip.start($q(this).data("guideid"),0)});for(var g in f){if(f.hasOwnProperty(g)){if(f[g]==-1){f[g]=Aero.tip._current+1}switch(g){case"click":c.off("click.aeronav").on("click.aeronav",c,function(){if(d){if(!AeroStep.admin){b.stop()}return}b.setStep(f[g]);b.jumpTo(f[g])});break;case"mousedown":c.off("mousedown.aeronav").on("mousedown.aeronav",c,function(){if(d){if(!AeroStep.admin){b.stop()}return}b.setStep(f[g]);b.jumpTo(f[g])});break;case"hover":c.off("mouseenter.aeronav").on("mouseenter.aeronav",c,function(){setTimeout(function(){b.jumpTo(f[g])},500)});break;case"blur":c.focus();c.off("keydown.aeronav").on("keydown.aeronav",c,function(i){var h=i.keyCode||i.which;if(h==13||h==9){b.jumpTo(f[g])}});break;case"unload":$q(window).off("beforeunload.aeronav").on("beforeunload.aeronav",function(){b.setStep(f[g])});break;case"observe":b.observe(b._current+1);break}}}}};"use strict";Aero.model.guide={url:"api/guides",urlSearch:"api/search",defaults:function(){return{title:"",active:false,steps:[]}},byId:function(b,a){Aero.guide.getAll(function(c){$q.each(c,function(e,d){if(d&&(b==d.id)){a(c[e]);aeroStorage.setItem("aero:session:index",e,function(){},true)}})})},update:function(b,a){Aero.guide.getAll(function(c){Aero.view.guide.render(c);if(b){b(a)}},true)},validate:function(){var a=$q("form").isFormValid();if($q("#aeroEditor").trumbowyg("html").replace(/<br>/g,"")==""){a=false;$q(".trumbowyg-editor").addClass("aero-require-error")}if(!a){$q("#aeroSection0 p:first").after('<div class="aero-error-box">'+AeroStep.lang.requirede+"</div>")}return a}};Aero.view.guide={render:function(c,d,b){var a=this;$q(".aero-restrict").remove();if(!b){a.clearSearch()}Aero.tpl.get("sidebar-guides.html",function(e){aeroStorage.getItem("aero:sidebar:open",function(f){aeroStorage.getItem("aero:session:tab",function(h){$q("#aeroGuidebar").remove();var g=_q.template(e);$q("body").append(g({sidebar:f,guides:c}));$q("#aeroStepbar").remove();$q("#aero-tab").css("top",h+"px");a.setEvents();Aero.view.sidebar.setEvents();Aero.view.sidebar.setScrollable();var i=parseInt($q("body").data("newguides"));if(i>0){Aero.view.sidebar.notify(i)}},true)},true)})},renderRestrict:function(a){var d=this;if(a.isComplete||!a.restrict||a.restrict.length==0){return}function c(g,i,e){var f,h;f=$q(i);if(f.length>0){h=$q("<a />").addClass("aero-restrict").css({"background-color":e,cursor:"pointer",opacity:0.5}).data("loc",i).data("guideid",a.id).data("step",parseInt(g));$q("body").append(h);d.positionRestrict(h)}}for(var b in a.restrict){b=parseInt(b.replace("s",""));if(a.step.length>0){c(b,a.step[b].loc,a.step[b].restrictColor)}}},positionRestrict:function(b){var a=$q(b.data("loc"));b.css({width:a.outerWidth(),height:a.outerHeight(),top:a.offset().top,left:a.offset().left,position:"absolute","z-index":99})},search:function(b){var a=this;$q(".aero-search i").switchClass("fa-search","fa-times",0);$q(".aero-search a").switchClass("aero-search-btn","aero-search-clear",0);Aero.guide.getByTerm(b,function(c){c.search=b;a.render(c,function(){},true)})},clearSearch:function(){if($q(".aero-search-clear").length>0){$q(".aero-search i").switchClass("fa-times","fa-search",0);$q(".aero-search a").switchClass("aero-search-clear","aero-search-btn",0);$q(".aero-search").removeClass("aero-active");$q("input[name=aero_search]").val(AeroStep.lang.search)}},setEvents:function(){var a=this;$q("body").off("click.aeroStart").on("click.aeroStart",".aero-guides ul li > a",function(){var b=$q(this).parents("li:eq(0)").data("guideid");Aero.tip.start(b)});$q("body").off("click.apF").on("focus.apF",".aero-sidebar input[name=aero_search]",function(){$q(this).parents("div:eq(0)").addClass("aero-active");if($q(this).val()==AeroStep.lang.search){$q(this).val("")}});$q("body").off("click.apB").on("blur.apB",".aero-sidebar input[name=aero_search]",function(){if($q(this).val()==""){$q(this).parents("div:eq(0)").removeClass("aero-active");$q(this).val(AeroStep.lang.search)}});$q("body").off("click.aS").on("click.aS",".aero-search a.aero-search-btn",function(){a.search($q("input[name=aero_search]").val())});$q("body").off("keypress.asK").on("keypress.asK",".aero-sidebar input[name=aero_search]",function(c){var b=c.keyCode||c.which;if(b==13){a.search($q(this).val())}});$q("body").off("click.asC").on("click.asC",".aero-search-clear",function(){Aero.guide.getAll(function(b){a.render(b)});return false});$q("body").off("click.asr").on("click.asr",".aero-restrict",function(){var b=$q(this);Aero.confirm({ok:AeroStep.lang.ok,title:AeroStep.lang.restrictt,msg:AeroStep.lang.restrictb,onConfirm:function(){Aero.tip.start(b.data("guideid"))}})});$q("body").on("click",'input[name="aero_auto"]',function(){$q(".aero-auto-page").hide();if($q(this).is(":checked")){$q(".aero-auto-page").show()}})}};Aero.guide={init:function(){var b=this;var a=aeroStorage.getItem("aero:session:end");if(a){Aero.tip.sayCongrats()}b.getAll(function(c){aeroStorage.getItem("aero:session",function(f){var e=window.location.hash.indexOf("guideid=")!=-1;if(f){var d=JSON.parse(f);aeroStorage.getItem("aero:session:current",function(j){Aero.tip.start(d.id,parseInt(j))},true)}else{if(e){var h=window.location.hash.split("=").slice(-1)[0];Aero.tip.start(h);window.location.hash=window.location.hash.split("guideid")[0]}else{var g=aeroStorage.getItem("aero:pathway");if(g&&g!="0"){Aero.pathway.get(function(j){var i=Aero.view.pathway.render(j,parseInt(g));if(!i){Aero.view.guide.render(c)}})}else{Aero.view.guide.render(c)}}}},true)})},autoStart:function(a){Aero.view.guide.renderRestrict(a);if(!a.auto){return}if(!a.isComplete&&!AeroStep.admin&&a.step.length>0){var b=false;if(a.autoPage){b=true}else{if(a.step.length>0&&window.location.pathname==a.step[0].url){b=true}}if(b){Aero.tip.start(a.id)}}},updateCache:function(a){aeroStorage.setItem("aero:guides",JSON.stringify(a))},getAll:function(e,c){var d=null;var a=aeroStorage.getItem("aero:guides");var b=aeroStorage.getItem("aero:cache");if(!b){b=AeroStep.cache}b=parseInt(b);if(b!=AeroStep.cache){d=JSON.parse(a);aeroStorage.removeItem("aero:guides");a=null}if(!a||c){Aero.log("Loading from SS","success");Aero.send(Aero.model.guide.url,{enduser:Aero.constants.USERNAME},function(f){if(d){var g=f.length-d.length;if(g>0){$q("body").data("newguides",g)}}aeroStorage.setItem("aero:cache",AeroStep.cache);aeroStorage.setItem("aero:guides",JSON.stringify(f));if(e){e(f)}})}else{Aero.log("Loading from LS","success");e(JSON.parse(a))}},get:function(b,a){Aero.send(Aero.model.guide.url,{id:b},function(c){if(a){a(c)}})},getByTerm:function(a,b){Aero.send(Aero.model.guide.urlSearch,{term:a},function(c){if(b){b(c)}})},create:function(a,b){Aero.send(Aero.model.guide.url,a,function(c){Aero.model.guide.update(b,c)},"POST")},update:function(a,b){Aero.send(Aero.model.guide.url,a,function(){Aero.model.guide.update();if(b){b()}},"PUT")},destroy:function(a){Aero.send(Aero.model.guide.url,{id:a},function(){Aero.model.guide.update()},"DELETE")}};Aero.view.sidebar={setScrollable:function(){var c=$q(window).height()-($q(".aero-head").outerHeight()+$q(".aero-foot").outerHeight());var d=$q(".aero-guide-title").outerHeight();var b=$q(".aero-add-step").length>0?$q(".aero-add-step").outerHeight():0;$q(".aero-guides, .aero-steps").height(c-(d+b))},show:function(a,b){if(!b){b-750}$q(".aero-sidebar").stop().animate({right:"-50px"},b,"easeInOutBack",function(){}).addClass("open");if(a){aeroStorage.setItem("aero:sidebar:open",1,function(){},true)}},hide:function(a){$q(".aero-sidebar").stop().animate({right:-($q(".aero-sidebar").outerWidth(true))},300,"swing",function(){}).removeClass("open");if($q(".aero-admin-wrapper").length){$q(".aero-admin-wrapper").remove();$q("#aero-tab").css("left","-44px")}$q(".aero-blanket, .aero-edit-active").remove();if(a){aeroStorage.setItem("aero:sidebar:open",0,function(){},true)}},notify:function(){$q("#aero-tab").prepend('<span class="aero-not">'+$q("body").data("newguides")+"</span>")},setEvents:function(){var b=this;var a;window.onresize=function(){clearTimeout(a);a=setTimeout(function(){b.setScrollable();var c=$q(".aero-restrict");if(c.length==0){return}c.each(function(){Aero.view.guide.positionRestrict($q(this))})},100)};$q("body").off("click.atc").on("click.atc","#aero-tab a",function(){if($q(".aero-sidebar").hasClass("open")){b.hide(true)}else{b.show(true)}});$q("#aero-tab").draggable({axis:"y",distance:10,stop:function(c,d){aeroStorage.setItem("aero:session:tab",d.offset.top,function(){},true)}});$q(window).off("hashchange.hashn").on("hashchange.hashn",function(){Aero.hashChange=true;AeroStep.ready(function(){setTimeout(function(){Aero.hashChange=false;Aero.guide.init()},500)},AeroStep.required)})}};"use strict";function AeroMain(){$q(function(){setTimeout(function(){aeroStorage.getItem("aero:sidebar:cdshost",function(b){if(b){var a=b.split("~");if(a[1]!=window.location.host){aeroStorage.setItem("aero:session:fake",a[0])}}Aero.guide.init()},true)},100)});Aero.pathway.init()}AeroMain();