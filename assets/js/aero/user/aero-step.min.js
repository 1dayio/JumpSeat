"use strict";Aero.model.step={url:"api/steps",defaults:function(a){var b=a+1;if(Aero.tip._guide.step){b=(a===Aero.tip._guide.step.length-1)?-1:a+1}return{loc:"",tries:3,position:"bottom",id:"astep-"+a,next:b,prev:a-1}},update:function(a){var c=parseInt(localStorage.getItem("aero:session:index"));var b=JSON.parse(localStorage.getItem("aero:guides"));b[c]=a;localStorage.setItem("aero:guides",JSON.stringify(b));Aero.tip.setGuide(a.id);Aero.view.step.render(b[c])},validate:function(){var b=$q("form").isFormValid();if($q("#aeroEditor").trumbowyg("html").replace(/<br>/g,"")==""){b=false;$q(".trumbowyg-editor").addClass("aero-require-error")}if(!b){$q("#aeroSection0 p:first").after('<div class="aero-error-box">'+AeroStep.lang.requirede+"</div>");var a=$q(".aero-require-error:eq(0)").parents(".aero-tab-content:eq(0)");if(a){a.parent().find('a[href="#'+a.attr("id")+'"]').click()}}return b}};Aero.view.step={render:function(a){var b=this;Aero.tpl.get("sidebar-steps.html",function(e){var d=localStorage.getItem("aero:sidebar:open");$q("#aeroStepbar").remove();var c=_q.template(e);$q("body").append(c({sidebar:d,g:a}));$q("#aeroGuidebar").remove();$q("#aero-tab").css("top",localStorage.getItem("aero:session:tab")+"px");b.setEvents();Aero.view.sidebar.setScrollable();return false});Aero.view.sidebar.setEvents()},renderShare:function(a){$q("body").append('<div class="aero-share-tip"><span></span><input type="text" value="'+a+'" /></div>');$q(".aero-share-tip input").select()},setState:function(a,b){if(!a){a=Aero.tip._current}if(b){$q(".aero-steps li:eq("+a+")").addClass("aero-"+b)}else{var c=$q(".aero-steps li:eq("+a+")");c.addClass("aero-active");c.removeClass("aero-forward aero-missing");localStorage.removeItem("aero:session:forward")}},setEvents:function(){var a=this;if(AeroStep.admin){$q("body").off("click.sa").on("click.sa",".aero-steps li > a",function(){Aero.tip.jumpTo($q(".aero-steps li").index($q(this).parent()))})}$q("body").off("click.sas").on("click.sas","a.aero-stop",function(){Aero.tip.stop()});$q("body").off("click.ashare").on("click.ashare","a.aero-share",function(){a.renderShare(Aero.host+$q(this).data("link"));return false});$q(document).click(function(b){if($q(b.target).hasClass("aero-share-tip")||$q(b.target).parent().hasClass("aero-share-tip")){return}$q(".aero-share-tip").remove()});if(AeroStep.admin){setTimeout("if(Aero.view.step.admin) Aero.view.step.admin.renderSortable();",100)}}};Aero.step={get:function(b){try{var a=new Aero.model.step.defaults(b);return $q.extend({},a,Aero.tip._guide.step[b])}catch(c){AeroStep.session.destroy();location.reload(true)}},add:function(a,b){a.id=Aero.tip._guide.id;a.insertAt=Aero.tip._current;Aero.send(Aero.model.step.url,a,function(e){Aero.model.step.update(e);var d=Aero.tip._current+1;var c=(d>Aero.tip._guide.step.length-1)?(Aero.tip._guide.step.length-1):d;Aero.tip.jumpTo(c);if(b){b(e)}},"POST")},update:function(a,b,c){b.id=Aero.tip._guide.id;b.index=a;Aero.send(Aero.model.step.url,b,function(d){Aero.model.step.update(d);Aero.tip.show();if(c){c(d)}},"PUT")},moveIndex:function(b,a){Aero.send(Aero.model.step.url+"/move",{id:Aero.tip._guide.id,from:b,to:a},function(c){Aero.model.step.update(c)},"PUT")},destroy:function(a,b){Aero.send(Aero.model.step.url,{id:Aero.tip._guide.id,index:a},function(c){Aero.model.step.update(c);if(a==Aero.tip._current){Aero.tip.next()}if(b){b(c)}},"DELETE")}};