"use strict";(function(e){var d=(e.browser.msie?"paste":"input")+".mask",f=window.orientation!=undefined;e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn"},e.fn.extend({caret:function(h,g){if(this.length!=0){if(typeof h=="number"){g=typeof g=="number"?g:h;return this.each(function(){if(this.setSelectionRange){this.setSelectionRange(h,g)}else{if(this.createTextRange){var a=this.createTextRange();a.collapse(!0),a.moveEnd("character",g),a.moveStart("character",h),a.select()}}})}if(this[0].setSelectionRange){h=this[0].selectionStart,g=this[0].selectionEnd}else{if(document.selection&&document.selection.createRange){var i=document.selection.createRange();h=0-i.duplicate().moveStart("character",-100000),g=h+i.text.length}}return{begin:h,end:g}}},unmask:function(){return this.trigger("unmask")},mask:function(p,o){if(!p&&this.length>0){var n=e(this[0]);return n.data(e.mask.dataName)()}o=e.extend({placeholder:"_",completed:null},o);var m=e.mask.definitions,l=[],c=p.length,b=null,a=p.length;e.each(p.split(""),function(h,g){g=="?"?(a--,c=h):m[g]?(l.push(new RegExp(m[g])),b==null&&(b=l.length-1)):l.push(null)});return this.trigger("unmask").each(function(){function z(s){var r=y.val(),v=-1;for(var u=0,t=0;u<a;u++){if(l[u]){x[u]=o.placeholder;while(t++<r.length){var q=r.charAt(t-1);if(l[u].test(q)){x[u]=q,v=u;break}}if(t>r.length){break}}else{x[u]==r.charAt(t)&&u!=c&&(t++,v=u)}}if(!s&&v+1<c){y.val(""),B(0,a)}else{if(s||v+1>=c){A(),s||y.val(y.val().substring(0,v+1))}}return c?u:b}function A(){return y.val(x.join("")).val()}function B(r,q){for(var s=r;s<q&&s<a;s++){l[s]&&(x[s]=o.placeholder)}}function C(r){var q=r.which,v=y.caret();if(r.ctrlKey||r.altKey||r.metaKey||q<32){return !0}if(q){v.end-v.begin!=0&&(B(v.begin,v.end),i(v.begin,v.end-1));var u=k(v.begin-1);if(u<a){var t=String.fromCharCode(q);if(l[u].test(t)){h(u),x[u]=t,A();var s=k(u);y.caret(s),o.completed&&s>=a&&o.completed.call(y)}}return !1}}function g(r){var q=r.which;if(q==8||q==46||f&&q==127){var u=y.caret(),t=u.begin,s=u.end;s-t==0&&(t=q!=46?j(t):s=k(t-1),s=q==46?k(s):s),B(t,s),i(t,s-1);return !1}if(q==27){y.val(w),y.caret(0,z());return !1}}function h(r){for(var q=r,u=o.placeholder;q<a;q++){if(l[q]){var t=k(q),s=x[q];x[q]=u;if(t<a&&l[t].test(s)){u=s}else{break}}}}function i(r,q){if(!(r<0)){for(var t=r,s=k(q);t<a;t++){if(l[t]){if(s<a&&l[t].test(x[s])){x[t]=x[s],x[s]=o.placeholder}else{break}s=k(s)}}A(),y.caret(Math.max(b,r))}}function j(q){while(--q>=0&&!l[q]){}return q}function k(q){while(++q<=a&&!l[q]){}return q}var y=e(this),x=e.map(p.split(""),function(r,q){if(r!="?"){return m[r]?o.placeholder:r}}),w=y.val();y.data(e.mask.dataName,function(){return e.map(x,function(r,q){return l[q]&&r!=o.placeholder?r:null}).join("")}),y.attr("readonly")||y.one("unmask",function(){y.unbind(".mask").removeData(e.mask.dataName)}).bind("focus.mask",function(){w=y.val();var q=z();A();var r=function(){q==p.length?y.caret(0,q):y.caret(q)};(e.browser.msie?r:function(){setTimeout(r,0)})()}).bind("blur.mask",function(){z(),y.val()!=w&&y.change()}).bind("keydown.mask",g).bind("keypress.mask",C).bind(d,function(){setTimeout(function(){y.caret(z(!0))},0)}),z()})}})})($q);Aero.model.step={url:"api/steps",defaults:function(a){var b=a+1;if(Aero.tip._guide.step){b=(a===Aero.tip._guide.step.length-1)?-1:a+1}return{loc:"",tries:3,position:"bottom",id:"astep-"+a,next:b,prev:a-1}},update:function(a){aeroStorage.getItem("aero:session:index",function(c){var b=JSON.parse(aeroStorage.getItem("aero:guides"));c=parseInt(c);b[c]=a;aeroStorage.setItem("aero:guides",JSON.stringify(b),function(){});aeroStorage.setItem("aero:session",JSON.stringify(b[c]),function(){Aero.tip.setGuide(a.id,function(){if(Aero.tip._current==Aero.tip._guide.step.length){Aero.tip._current--}if(!Aero.tip._current){Aero.tip._current=0}Aero.tip.jumpTo(Aero.tip._current)})},true)},true)},validate:function(){var b=$q("form").isFormValid();if($q("#aeroEditor").trumbowyg("html").replace(/<br>/g,"")==""){b=false;$q(".trumbowyg-editor").addClass("aero-require-error")}if(!b){$q("#aeroSection0 p:first").after('<div class="aero-error-box">'+AeroStep.lang.requirede+"</div>");var a=$q(".aero-require-error:eq(0)").parents(".aero-tab-content:eq(0)");if(a){a.parent().find('a[href="#'+a.attr("id")+'"]').click()}}return b}};Aero.view.step={render:function(a){var b=this;Aero.tpl.get("sidebar-steps.html",function(c){aeroStorage.getItem("aero:sidebar:open",function(d){aeroStorage.getItem("aero:session:tab",function(f){$q("#aeroStepbar").remove();var e=_q.template(c);$q("body").append(e({sidebar:d,g:a}));$q("#aeroGuidebar").remove();if(f>$q("#aeroStepbar").outerHeight()){f=$q("#aeroStepbar").outerHeight()-100}if(f<0){f=0}$q("#aero-tab").css("top",f+"px");b.setEvents();Aero.view.sidebar.setScrollable()},true)},true)});Aero.view.sidebar.setEvents()},renderShare:function(a){$q("body").append('<div class="aero-share-tip"><span></span><input type="text" value="'+a+'" /></div>');$q(".aero-share-tip input").select()},setState:function(c,e){if(!c){c=Aero.tip._current}if(e){$q(".aero-steps li:eq("+c+")").addClass("aero-"+e)}else{var g=$q(".aero-steps li:eq("+c+")");g.addClass("aero-active");g.removeClass("aero-forward aero-missing");aeroStorage.removeItem("aero:session:forward",function(){},true)}var d=$q("div.aero-steps");var b=$q("li.aero-active");var a=$q("div.aero-add-step");var f=0;if(b.length>0){if(a.length>0){f+=a.outerHeight()}d.animate({scrollTop:d.scrollTop()+b.position().top-d.height()/2+b.height()/2-f-$q(".aero-guide-title").outerHeight()})}},setEvents:function(){var a=this;if(AeroStep.admin){$q("body").off("click.sa").on("click.sa",".aero-steps li > a",function(){Aero.tip.jumpTo($q(".aero-steps li").index($q(this).parent()))})}$q("body").off("click.sas").on("click.sas","a.aero-stop",function(){Aero.tip.stop()});$q("body").off("click.ashare").on("click.ashare","a.aero-share",function(){a.renderShare(Aero.host+$q(this).data("link"));return false});$q(document).click(function(b){if($q(b.target).hasClass("aero-share-tip")||$q(b.target).parent().hasClass("aero-share-tip")){return}$q(".aero-share-tip").remove()});$q("#aero-tab").draggable({axis:"y",distance:10,containment:"#aeroStepbar",stop:function(b,c){aeroStorage.setItem("aero:session:tab",c.offset.top,function(){},true)}});if(AeroStep.admin){setTimeout("if(Aero.view.step.admin) Aero.view.step.admin.renderSortable();",100)}}};Aero.step={get:function(b){try{var a=new Aero.model.step.defaults(b);return $q.extend({},a,Aero.tip._guide.step[b])}catch(c){AeroStep.session.destroy();location.reload(true)}},add:function(a,b){a.id=Aero.tip._guide.id;a.insertAt=Aero.tip._current?Aero.tip._current:0;Aero.send(Aero.model.step.url,a,function(c){if(Aero.tip._guide.step.length!=0){Aero.tip._current++}Aero.model.step.update(c);if(b){b(c)}},"POST")},update:function(a,b,c){b.id=Aero.tip._guide.id;b.index=a;Aero.send(Aero.model.step.url,b,function(d){Aero.model.step.update(d);if(c){c(d)}},"PUT")},moveIndex:function(b,a){Aero.send(Aero.model.step.url+"/move",{id:Aero.tip._guide.id,from:b,to:a},function(c){Aero.model.step.update(c)},"PUT")},destroy:function(a,b){Aero.send(Aero.model.step.url,{id:Aero.tip._guide.id,index:a},function(c){Aero.model.step.update(c);if(b){b(c)}},"DELETE")}};